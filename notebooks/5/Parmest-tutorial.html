
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>5.1. Parameter estimation with parmest &#8212; Optimization for Decision Science</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/5/Parmest-tutorial';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="5.2. Supplementary material: data for parmest tutorial" href="Parmest-generate-data.html" />
    <link rel="prev" title="5. Data Science and Applied Statistics" href="data.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/cbe_logo.jpg" class="logo__image only-light" alt="Optimization for Decision Science - Home"/>
    <script>document.write(`<img src="../../_static/cbe_logo.jpg" class="logo__image only-dark" alt="Optimization for Decision Science - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../intro.html">
                    Optimization for Decision Science
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Organization</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../org/intro.html">Welcome</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../org/syllabus.html">Syllabus</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../org/calendar.html">Fall 2024 Calendar</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../org/contribute.html">Contribution Instructions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../org/workshop.html">Computational Optimization in Python (São Paulo, Brazil)</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../org/assignments.html">Assignments</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../assignments/Pyomo1.html">Pyomo Homework 1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../assignments/Pyomo2.html">Pyomo Homework 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../assignments/Pyomo3.html">Pyomo Homework 3</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../org/project1.html">Project 1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../assignments/Algorithms1.html">Algorithms Homework 1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../assignments/Algorithms2.html">Algorithms Homework 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../org/project2.html">Project 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../assignments/Algorithms3.html">Algorithms Homework 3</a></li>
<li class="toctree-l2"><a class="reference internal" href="../assignments/Algorithms4.html">Algorithms Homework 4</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../org/archive.html">Archive</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../assignments/Pyomo-Mini-Project.html">Pyomo Mini-Project: Receding Horizon Stochastic Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../org/semester_project.html">Semester Project (Spring 2023)</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Optimization Modeling in Pyomo</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../1/getting-started.html">1. Getting Started with Pyomo</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../1/Local-Install.html">1.1. Local Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../1/Optimization-Modeling.html">1.2. Optimization Modeling with Applications</a></li>
<li class="toctree-l2"><a class="reference internal" href="../1/Pyomo-Introduction.html">1.3. Your First Optimization Problem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../1/LP.html">1.4. Continuous Optimization: Linear Programming</a></li>
<li class="toctree-l2"><a class="reference internal" href="../1/NLP.html">1.5. Continuous Optimization: Nonlinear Programming</a></li>
<li class="toctree-l2"><a class="reference internal" href="../1/IP.html">1.6. Integer Programs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../1/Pyomo-Nuts-and-Bolts.html">1.7. 60 Minutes to Pyomo: An Energy Storage Model Predictive Control Example</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../2/logic.html">2. Logical Modeling</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../2/Logical_Modeling_GDP.html">2.1. Logical Modeling and Generalized Disjunctive Programs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../2/Modeling_Disjunctions_Strip_Packing.html">2.2. Modeling Disjunctions through the Strip Packing Problem</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../3/dynamics.html">3. Dynamic Optimization</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../3/PyomoDAE_car.html">3.1. Pyomo.DAE Example: Race Car</a></li>
<li class="toctree-l2"><a class="reference internal" href="../3/PyomoDAE_TCLab.html">3.2. Pyomo.DAE Example: Temperature Control Lab</a></li>
<li class="toctree-l2"><a class="reference internal" href="../3/DAE_background.html">3.3. Differential Algebraic Equations (DAEs)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../3/DAE_numeric_integration.html">3.4. Numeric Integration for DAEs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../3/PyomoDAE_theory.html">3.5. Dynamic Optimization with Collocation and Pyomo.DAE</a></li>
<li class="toctree-l2"><a class="reference internal" href="../3/PyomoDAE_example.html">3.6. Pyomo.DAE: Racing Example Revisited</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../4/uncertainty.html">4. Optimization Under Uncertainty</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../4/SP.html">4.1. Stochastic Programming</a></li>
<li class="toctree-l2"><a class="reference internal" href="../4/blocks.html">4.2. Blocks and Other Pyomo Best Practices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../4/AdvancedTopics.html">4.3. Advanced Topics in Stochastic Programming</a></li>
<li class="toctree-l2"><a class="reference internal" href="../4/RiskMeasures.html">4.4. Risk Measures and Portfolio Optimization</a></li>
</ul>
</details></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="data.html">5. Data Science and Applied Statistics</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2 current active"><a class="current reference internal" href="#">5.1. Parameter estimation with <code class="docutils literal notranslate"><span class="pre">parmest</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="Parmest-generate-data.html">5.2. Supplementary material: data for parmest tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="Pyomo_DoE_Tutorial.html">5.3. Optimizing Experiments with <code class="docutils literal notranslate"><span class="pre">Pyomo.DoE</span></code></a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Algorithms and Theory</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../6/unconstrained.html">6. Unconstrained Nonlinear Optimization</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../6/Math-Primer-1.html">6.1. Linear Algebra Review and SciPy Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../6/Math-Primer-2.html">6.2. Mathematics Primer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../6/Optimality.html">6.3. Unconstrained Optimality Conditions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../6/Newton-Methods.html">6.4. Newton-type Methods for Unconstrained Optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../6/Quasi-Newton-Methods.html">6.5. Quasi-Newton Methods for Unconstrained Optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../6/Globalization.html">6.6. Descent and Globalization</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../7/constrained.html">7. Constrained Nonlinear Optimization</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../7/Convexity.html">7.1. Convexity Revisited</a></li>
<li class="toctree-l2"><a class="reference internal" href="../7/Local-Optimality.html">7.2. Local Optimality Conditions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../7/KKT-Multipliers.html">7.3. Analysis of KKT Conditions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../7/Constraint-Qualifications.html">7.4. Constraint Qualifications</a></li>
<li class="toctree-l2"><a class="reference internal" href="../7/Second-Order.html">7.5. Second Order Optimality Conditions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../7/degeneracy_hunter.html">7.6. NLP Diagnostics with Degeneracy Hunter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../7/Interior-Point1.html">7.7. Simple Netwon Method for Equality Constrained NLPs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../7/Interior-Point2.html">7.8. Inertia-Corrected Netwon Method for Equality Constrained NLPs</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../8/special-topics.html">8. Special Topics</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../8/MILP.html">8.1. Integer Programming with Simple Branch and Bound</a></li>
<li class="toctree-l2"><a class="reference internal" href="../8/MINLP-Algorithms.html">8.2. MINLP Algorithms</a></li>
<li class="toctree-l2"><a class="reference internal" href="../8/Global-Opt.html">8.3. Deterministic Global Optimization</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Student Contributions</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../contrib/pyomo.html">More Pyomo Examples</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../contrib/semiconductor_manufacturing.html">Semiconductor Production Planning</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contrib/student_diet.html">Optimization of Daily Diet Using Pyomo</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contrib/blending.html">Blending Under Uncertainty</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contrib/vehicle_routing.html">Vehicle Routing</a></li>

<li class="toctree-l2"><a class="reference internal" href="../contrib/portfolio_optimization_extended.html">Risk Measures and Portfolio Optimization: Expanded</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contrib/race_car_extended.html">Extended Race Car Optimization Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contrib/hot_air_balloon.html">Hot Air Balloon Dynamic Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contrib/reactor_design.html">Chemical Reactor Design</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contrib/Disaster_Response_Plan.html">Disaster Response Plan Optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contrib/Sudoku_Solver.html">Sudoku Solver</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contrib/more_circle_packing.html">Circle Packing Optimization</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../contrib/modeling.html">Modeling Paradigms</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../contrib/multi_objective.html">Multi-Objective Optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contrib/advanced_stochastic_programming.html">Advanced Topics in Stochastic Programming</a></li>






</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../contrib/algorithms.html">Global Optimization</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../contrib/Deterministic_Global_Optimization.html">Deterministic Global Optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contrib/Bayesian_Optimization1.html">Bayesian Optimization Tutorial 1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contrib/Bayesian_Optimization2.html">Bayesian Optimization Tutorial 2</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../contrib/sgd.html">Stochastic Gradient Descent</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../contrib/Stochastic-Gradient-Descent-1.html">Stochastic Gradient Descent Tutorial 1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contrib/Stochastic-Gradient-Descent-2.html">Stochastic Gradient Descent Tutorial 2</a></li>






<li class="toctree-l2"><a class="reference internal" href="../contrib/Stochastic-Gradient-Descent-3.html">Stochastic Gradient Descent Tutorial 3</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../contrib/data.html">Machine Learning and Applied Statistics</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../contrib/EM-MAP.html">Expectation Maximization Algorithm and MAP Estimation</a></li>
</ul>
</details></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/ndcbe/optimization/blob/master/notebooks/5/Parmest-tutorial.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Colab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Colab logo" src="../../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/ndcbe/optimization" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/ndcbe/optimization/issues/new?title=Issue%20on%20page%20%2Fnotebooks/5/Parmest-tutorial.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/notebooks/5/Parmest-tutorial.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Parameter estimation with parmest</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-is-parameter-estimation">5.1.1. What is parameter estimation?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-is-parmest">5.1.2. What is <code class="docutils literal notranslate"><span class="pre">parmest</span></code>?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-reaction-kinetics">5.1.3. Example: Reaction Kinetics</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#batch-reactor">5.1.3.1. Batch Reactor</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#experimental-data">5.1.3.2. Experimental Data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pyomo-model">5.1.3.3. Pyomo model</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#parameter-estimation-with-a-single-dataset">5.1.4. Parameter estimation with a single dataset</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#parameter-estimation-with-multiple-datasets">5.1.5. Parameter estimation with multiple datasets</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#generate-experiment-list">5.1.5.1. Generate Experiment list</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">5.1.5.2. Parameter estimation with parmest</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plotting-fitted-model-simulation-with-experimental-data">5.1.5.3. Plotting fitted model simulation with ‘experimental’ data</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#using-parmest-with-pyomo-dae">5.1.6. Using <code class="docutils literal notranslate"><span class="pre">parmest</span></code> with <code class="docutils literal notranslate"><span class="pre">pyomo.dae</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">5.1.6.1. Parameter estimation with parmest</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">5.1.6.2. Plotting fitted model simulation with ‘experimental’ data</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#local-uncertainty-analysis">5.1.7. Local uncertainty analysis</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#covariance-matrix">5.1.7.1. Covariance matrix</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#parameter-identifiability">5.1.7.2. Parameter identifiability</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#bootstrap-resampling">5.1.8. Bootstrap resampling</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#nonlinear-confidence-regions">5.1.9. Nonlinear confidence regions</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="parameter-estimation-with-parmest">
<h1><span class="section-number">5.1. </span>Parameter estimation with <code class="docutils literal notranslate"><span class="pre">parmest</span></code><a class="headerlink" href="#parameter-estimation-with-parmest" title="Link to this heading">#</a></h1>
<p>Created by <a class="reference external" href="https://github.com/kanishka-ghosh">Kanishka Ghosh</a>, <a class="reference external" href="https://github.com/jialuw96">Jialu Wang</a>, <a class="reference external" href="https://github.com/adowling2/">Prof. Alex Dowling</a>, and <a class="reference external" href="https://github.com/sscini">Stephen Cini</a> at the University of Notre Dame. Last updated December 2024.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># This code cell installs packages on Colab</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>

<span class="k">if</span> <span class="s2">&quot;google.colab&quot;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">:</span>
    <span class="o">!</span>wget<span class="w"> </span><span class="s2">&quot;https://raw.githubusercontent.com/ndcbe/optimization/main/notebooks/helper.py&quot;</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">helper</span>
    <span class="n">helper</span><span class="o">.</span><span class="n">install_idaes</span><span class="p">()</span>
    <span class="n">helper</span><span class="o">.</span><span class="n">install_ipopt</span><span class="p">()</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;../&#39;</span><span class="p">)</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">helper</span>
<span class="n">helper</span><span class="o">.</span><span class="n">set_plotting_style</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyomo.environ</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pyo</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyomo.dae</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">dae</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyomo</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">idaes</span>

<span class="c1"># Define the directory to save/read the data files</span>
<span class="n">data_dir</span> <span class="o">=</span> <span class="s1">&#39;https://raw.githubusercontent.com/ndcbe/optimization/main/notebooks/data/&#39;</span>
</pre></div>
</div>
</div>
</div>
<section id="what-is-parameter-estimation">
<h2><span class="section-number">5.1.1. </span>What is parameter estimation?<a class="headerlink" href="#what-is-parameter-estimation" title="Link to this heading">#</a></h2>
<p>Given a function <span class="math notranslate nohighlight">\(f(x,\theta)\)</span> where <span class="math notranslate nohighlight">\(x\)</span> is the input or array of inputs, <span class="math notranslate nohighlight">\(\theta\)</span> is the vector of unknown model parameters, and <span class="math notranslate nohighlight">\(y\)</span> is the array of observed output, parameter estimation is performed to determine the values of <span class="math notranslate nohighlight">\(\theta\)</span> to minimize the error between <span class="math notranslate nohighlight">\(f(x,\theta)\)</span> and <span class="math notranslate nohighlight">\(y\)</span>.  Commonly, parameter estimation is set up as a least squares objective problem:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align}
\begin{split}
    \min_{\hat{\theta}} \quad &amp; \sum_{i}^{} (y_i - f(x_i,\hat{\theta}))^2\\
    \textrm{s.t.} \quad &amp; \mathrm{bounds \ on} \ \theta\\
    &amp; \mathrm{other \ physical \ constraints}\\
\end{split}
\end{align}
\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(i\)</span> is used to index the datapoints in a dataset and <span class="math notranslate nohighlight">\(\hat{\theta}\)</span> is the optimal set of parameter values that minimizes the prediction error.</p>
</section>
<section id="what-is-parmest">
<h2><span class="section-number">5.1.2. </span>What is <code class="docutils literal notranslate"><span class="pre">parmest</span></code>?<a class="headerlink" href="#what-is-parmest" title="Link to this heading">#</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">parmest</span></code> is a Python package built on the <a class="reference external" href="http://www.pyomo.org/">Pyomo optimization modeling language</a> to support parameter estimation using experimental data along with confidence regions and subsequent creation of scenarios for <a class="reference external" href="https://github.com/Pyomo/pysp">PySP</a>. <code class="docutils literal notranslate"><span class="pre">parmest</span></code> supports scenario generation for multiple ‘experiments’ and can be used to characterize estimate uncertainties through, for example, confidence region generations. <code class="docutils literal notranslate"><span class="pre">parmest</span></code> requires the following positional arguments in order solve the optimization problem:</p>
<ol class="arabic">
<li><p><code class="docutils literal notranslate"><span class="pre">Experiment</span></code> class with the following functions:</p>
<p><strong>init</strong> - Loads data into class, and initializes model to contain no information.</p>
<p>create_model - Define the model in a generic form with needed variables and parameters.</p>
<p>finalize_model - Initialize and/or discretize the model from create_model for use with specified data.</p>
<p>label_model - Add required labels. <code class="docutils literal notranslate"><span class="pre">parmest</span></code> requires the model contains labeled unknown_parameters and model_outputs.
<code class="docutils literal notranslate"><span class="pre">pyomo.DoE</span></code> additionally requires model_inputs and measurement_error.</p>
<p>get_labeled_model - Calls previous functions to generate complete model for each <code class="docutils literal notranslate"><span class="pre">Experiment</span></code>.</p>
</li>
<li><p>Optional keyword argument to define the verbosity of solver output.  Default: False</p></li>
</ol>
<p>More information about the <code class="docutils literal notranslate"><span class="pre">parmest</span></code> package can be found <a class="reference external" href="https://pyomo.readthedocs.io/en/6.8.0/contributed_packages/parmest/index.html">here</a>.</p>
<p>Detailed explanation of the various methods in <code class="docutils literal notranslate"><span class="pre">parmest</span></code> can be found <a class="reference external" href="https://www.osti.gov/servlets/purl/1761797">here</a>.</p>
</section>
<section id="example-reaction-kinetics">
<h2><span class="section-number">5.1.3. </span>Example: Reaction Kinetics<a class="headerlink" href="#example-reaction-kinetics" title="Link to this heading">#</a></h2>
<p>Consider two chemical reactions that convert molecule <span class="math notranslate nohighlight">\(A\)</span> to desired product <span class="math notranslate nohighlight">\(B\)</span> and a less valuable side-product <span class="math notranslate nohighlight">\(C\)</span>.</p>
<div class="math notranslate nohighlight">
\[A \overset{k_1}{\rightarrow} B \overset{k_2}{\rightarrow} C\]</div>
<p>Our ultimate goals is to design a large-scale continous reactor that maximizes the production of <span class="math notranslate nohighlight">\(B\)</span>. This general sequential reactions problem is widely applicable to CO<span class="math notranslate nohighlight">\(_2\)</span> capture and industry more broadly (petrochemicals, pharmasuticals, etc.).</p>
<p>The rate laws for these two chemical reactions are:</p>
<div class="math notranslate nohighlight">
\[r_A = -k_1 C_A\]</div>
<div class="math notranslate nohighlight">
\[r_B = k_1 C_A - k_2 C_B\]</div>
<div class="math notranslate nohighlight">
\[r_C = k_2 C_B\]</div>
<p>Here, <span class="math notranslate nohighlight">\(C_A\)</span>, <span class="math notranslate nohighlight">\(C_B\)</span>, and <span class="math notranslate nohighlight">\(C_C\)</span> are the concentrations of each species. The rate constants <span class="math notranslate nohighlight">\(k_1\)</span> and <span class="math notranslate nohighlight">\(k_2\)</span> depend on temperature as follows:</p>
<div class="math notranslate nohighlight">
\[k_1 = A_1 \exp{\frac{-E_1}{R T}}\]</div>
<div class="math notranslate nohighlight">
\[k_2 = A_2 \exp{\frac{-E_2}{R T}}\]</div>
<p><span class="math notranslate nohighlight">\(A_1, A_2, E_1\)</span>, and <span class="math notranslate nohighlight">\(E_2\)</span> are fitted model parameters. <span class="math notranslate nohighlight">\(R\)</span> is the ideal-gas constant and <span class="math notranslate nohighlight">\(T\)</span> is absolute temperature.</p>
<section id="batch-reactor">
<h3><span class="section-number">5.1.3.1. </span>Batch Reactor<a class="headerlink" href="#batch-reactor" title="Link to this heading">#</a></h3>
<p>The concentrations in a batch reactor evolve with time per the following differential equations:</p>
<div class="math notranslate nohighlight">
\[ \frac{d C_A}{dt} = r_A = -k_1 C_A \]</div>
<div class="math notranslate nohighlight">
\[ \frac{d C_B}{dt} = r_B = k_1 C_A - k_2 C_B \]</div>
<div class="math notranslate nohighlight">
\[ \frac{d C_C}{dt} = r_C = k_2 C_B \]</div>
<p>This is a linear system of differential equations. Assuming the feed is only species <span class="math notranslate nohighlight">\(A\)</span>, i.e.,</p>
<div class="math notranslate nohighlight">
\[C_A(t=0) = C_{A0} \quad C_B(t=0) = 0 \quad C_C(t=0) = 0\]</div>
<p>leads to the following analytic solution:</p>
<div class="math notranslate nohighlight">
\[C_A(t) = C_{A,0} \exp(-k_1 t)\]</div>
<div class="math notranslate nohighlight">
\[C_B(t) = \frac{k_1}{k_2 - k_1} C_{A,0} \left[\exp(-k_1 t) - \exp(-k_2 t) \right]\]</div>
<div class="math notranslate nohighlight">
\[C_C(t) = C_{A,0} - \frac{k_2}{k_2 - k_1} C_{A,0} \exp(-k_1 t) + \frac{k_1}{k_2 - k_1} \exp(-k_2 t) C_{A,0} = C_{A,0} - C_{A}(t) - C_{B}(t)\]</div>
<p>The following Python code simulates and plots this model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">kinetics</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">T</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39; Computes kinetics from Arrhenius equation</span>

<span class="sd">    Arguments:</span>
<span class="sd">        A: pre-exponential factor, [1 / hr]</span>
<span class="sd">        E: activation energy, [kJ / mol]</span>
<span class="sd">        T: temperature, [K]</span>

<span class="sd">    Returns:</span>
<span class="sd">        k: reaction rate coefficient, [1 / hr]</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">R</span> <span class="o">=</span> <span class="mf">8.31446261815324</span> <span class="c1"># J / K / mole</span>

    <span class="k">return</span> <span class="n">A</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">E</span><span class="o">*</span><span class="mi">1000</span><span class="o">/</span><span class="p">(</span><span class="n">R</span><span class="o">*</span><span class="n">T</span><span class="p">))</span>

<span class="k">def</span><span class="w"> </span><span class="nf">concentrations</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">CA0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns concentrations at time t</span>

<span class="sd">    Arguments:</span>
<span class="sd">        t: time, [hr]</span>
<span class="sd">        k: reaction rate coefficient, [1 / hr]</span>
<span class="sd">        CA0: initial concentration of A, [mol / L]</span>

<span class="sd">    Returns:</span>
<span class="sd">        CA, CB, CC: concentrations of A, B, and C at time t, [mol / L]</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">CA</span> <span class="o">=</span> <span class="n">CA0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">t</span><span class="p">);</span>
    <span class="n">CB</span> <span class="o">=</span> <span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">CA0</span><span class="o">/</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">t</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">t</span><span class="p">));</span>
    <span class="n">CC</span> <span class="o">=</span> <span class="n">CA0</span> <span class="o">-</span> <span class="n">CA</span> <span class="o">-</span> <span class="n">CB</span><span class="p">;</span>

    <span class="k">return</span> <span class="n">CA</span><span class="p">,</span> <span class="n">CB</span><span class="p">,</span> <span class="n">CC</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">CA0</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># Moles/L</span>
<span class="n">k</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">]</span> <span class="c1"># 1/hr</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">51</span><span class="p">)</span>
<span class="n">CA</span><span class="p">,</span> <span class="n">CB</span><span class="p">,</span> <span class="n">CC</span> <span class="o">=</span> <span class="n">concentrations</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">CA0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">CA</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;$C_</span><span class="si">{A}</span><span class="s2">$&quot;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">CB</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;$C_</span><span class="si">{B}</span><span class="s2">$&quot;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-.&quot;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">CC</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;$C_</span><span class="si">{C}</span><span class="s2">$&quot;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time [hours]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Concentration [mol/L]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Batch Reactor Model&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/5c9a0da40317cfb95f001848d1c76603b34a12a7fce2fa8a330755c0741f5d4a.png" src="../../_images/5c9a0da40317cfb95f001848d1c76603b34a12a7fce2fa8a330755c0741f5d4a.png" />
</div>
</div>
</section>
<section id="experimental-data">
<h3><span class="section-number">5.1.3.2. </span>Experimental Data<a class="headerlink" href="#experimental-data" title="Link to this heading">#</a></h3>
<p>See the notebook <em>Supplementary material: data for parmest tutorial</em> for details on how these experimental data were generated (via simulation).</p>
<p>Experimental data consists of the concentration of species A, B, and C in <span class="math notranslate nohighlight">\(\mathrm{mol/L}\)</span> with respect to time <span class="math notranslate nohighlight">\(t\)</span> in <span class="math notranslate nohighlight">\(\mathrm{hours}\)</span> inside the batch reactor. The experimental data is stored in csv files where the first column records the time <span class="math notranslate nohighlight">\(t\)</span> in the reactor. Next, the temperature <span class="math notranslate nohighlight">\(T\)</span> in <span class="math notranslate nohighlight">\(\mathrm{K}\)</span> at which the reaction was simulated is recorded followed by the initial concentration of species A, <span class="math notranslate nohighlight">\(C_{A,0}\)</span>, in <span class="math notranslate nohighlight">\(\mathrm{mol/L}\)</span>. Finally, the time-varying species concentrations (<span class="math notranslate nohighlight">\(C_A\)</span>), (<span class="math notranslate nohighlight">\(C_B\)</span>), and (<span class="math notranslate nohighlight">\(C_C\)</span>) are recorded in <span class="math notranslate nohighlight">\(\mathrm{mol/L}\)</span>. Following is how the pandas dataframe of a single experiment looks like:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># define function to plot</span>
<span class="k">def</span><span class="w"> </span><span class="nf">plot_exp</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">CA0</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Plot concentration profiles</span>
<span class="sd">    Arguments:</span>
<span class="sd">        k: kinetic parameters</span>
<span class="sd">        CA0: initial concentration</span>
<span class="sd">        data: Pandas data frame</span>
<span class="sd">        text: plot title</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># evaluate models</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">51</span><span class="p">)</span>
    <span class="n">CA</span><span class="p">,</span> <span class="n">CB</span><span class="p">,</span> <span class="n">CC</span> <span class="o">=</span> <span class="n">concentrations</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">CA0</span><span class="p">)</span>

    <span class="c1"># plot model-generated and &#39;experimental&#39; data</span>
    <span class="c1"># symbols for &#39;experimental&#39; data</span>
    <span class="c1"># solid and dashed lines for model-generated data</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">CA</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;$C_</span><span class="si">{A}</span><span class="s2">$&quot;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">CA</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="nb">str</span><span class="p">())</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">CB</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;$C_</span><span class="si">{B}</span><span class="s2">$&quot;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-.&quot;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">CB</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="nb">str</span><span class="p">())</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">CC</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;$C_</span><span class="si">{C}</span><span class="s2">$&quot;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">CC</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;^&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="nb">str</span><span class="p">())</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time [hours]&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Concentration [mol/L]&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="pyomo-model">
<h3><span class="section-number">5.1.3.3. </span>Pyomo model<a class="headerlink" href="#pyomo-model" title="Link to this heading">#</a></h3>
<p>In the following cell, we define a function to define and return the Pyomo model for the kinetic model to be used for parameter estimation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pyomo.contrib.parmest.parmest</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">parmest</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyomo.contrib.parmest.experiment</span><span class="w"> </span><span class="kn">import</span> <span class="n">Experiment</span>

<span class="k">def</span><span class="w"> </span><span class="nf">reaction_kinetics_model</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>

    <span class="c1"># define Pyomo model</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">ConcreteModel</span><span class="p">()</span>
    <span class="n">m</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># K</span>
    <span class="n">m</span><span class="o">.</span><span class="n">CA0</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;CA0&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># mol/L</span>
    <span class="n">m</span><span class="o">.</span><span class="n">R</span> <span class="o">=</span> <span class="mf">8.31446261815324</span> <span class="c1"># J / K / mol</span>

    <span class="c1"># # define &#39;experimental&#39; data timesteps as Pyomo set</span>
    <span class="n">m</span><span class="o">.</span><span class="n">t</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="n">initialize</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>

    <span class="c1"># Kinetic parameters to be fitted defined as Pyomo variables</span>
    <span class="c1"># Initialized by &#39;true&#39; values</span>
    <span class="n">m</span><span class="o">.</span><span class="n">A1</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="mi">300</span><span class="p">))</span> <span class="c1"># 1/hr</span>
    <span class="n">m</span><span class="o">.</span><span class="n">A2</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">300</span><span class="p">,</span><span class="mi">500</span><span class="p">))</span> <span class="c1"># 1/hr</span>
    <span class="n">m</span><span class="o">.</span><span class="n">E1</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span> <span class="c1"># kJ/mol</span>
    <span class="n">m</span><span class="o">.</span><span class="n">E2</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">30</span><span class="p">))</span> <span class="c1"># kJ/mol</span>

    <span class="c1"># Concentration variables indexed by time</span>
    <span class="n">m</span><span class="o">.</span><span class="n">CA</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">initialize</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">CA0</span><span class="p">)</span> <span class="c1"># mol/L</span>
    <span class="n">m</span><span class="o">.</span><span class="n">CB</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">initialize</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="c1"># mol/L</span>
    <span class="n">m</span><span class="o">.</span><span class="n">CC</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">initialize</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="c1"># mol/L</span>


    <span class="c1"># kinetic rate constants from Arrhenius equation</span>
    <span class="n">m</span><span class="o">.</span><span class="n">k1</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Expression</span><span class="p">(</span><span class="n">rule</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">A1</span> <span class="o">*</span> <span class="n">pyo</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">m</span><span class="o">.</span><span class="n">E1</span><span class="o">*</span><span class="mi">1000</span><span class="o">/</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">R</span><span class="o">*</span><span class="n">m</span><span class="o">.</span><span class="n">T</span><span class="p">)))</span> <span class="c1"># 1/hr</span>
    <span class="n">m</span><span class="o">.</span><span class="n">k2</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Expression</span><span class="p">(</span><span class="n">rule</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">A2</span> <span class="o">*</span> <span class="n">pyo</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">m</span><span class="o">.</span><span class="n">E2</span><span class="o">*</span><span class="mi">1000</span><span class="o">/</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">R</span><span class="o">*</span><span class="n">m</span><span class="o">.</span><span class="n">T</span><span class="p">)))</span> <span class="c1"># 1/hr</span>

    <span class="c1"># Constraints to change concentrations based on kinetics</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">conc_A</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">i</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="o">.</span><span class="n">Skip</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">CA</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">m</span><span class="o">.</span><span class="n">CA0</span> <span class="o">*</span> <span class="n">pyo</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">m</span><span class="o">.</span><span class="n">k1</span><span class="o">*</span><span class="n">i</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">CA_rate</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">t</span><span class="p">,</span><span class="n">rule</span><span class="o">=</span><span class="n">conc_A</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">conc_B</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">i</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="o">.</span><span class="n">Skip</span>
        <span class="k">else</span><span class="p">:</span>            
            <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">CB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">m</span><span class="o">.</span><span class="n">k1</span><span class="o">*</span><span class="n">m</span><span class="o">.</span><span class="n">CA0</span><span class="o">/</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">k2</span><span class="o">-</span><span class="n">m</span><span class="o">.</span><span class="n">k1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">pyo</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">m</span><span class="o">.</span><span class="n">k1</span><span class="o">*</span><span class="n">i</span><span class="p">)</span> <span class="o">-</span> <span class="n">pyo</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">m</span><span class="o">.</span><span class="n">k2</span><span class="o">*</span><span class="n">i</span><span class="p">))</span>
    <span class="n">m</span><span class="o">.</span><span class="n">CB_rate</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">t</span><span class="p">,</span><span class="n">rule</span><span class="o">=</span><span class="n">conc_B</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">conc_C</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">i</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="o">.</span><span class="n">Skip</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">CC</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">m</span><span class="o">.</span><span class="n">CA0</span> <span class="o">-</span> <span class="n">m</span><span class="o">.</span><span class="n">CA</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">m</span><span class="o">.</span><span class="n">CB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">m</span><span class="o">.</span><span class="n">CC_rate</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">t</span><span class="p">,</span><span class="n">rule</span><span class="o">=</span><span class="n">conc_C</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">m</span>

<span class="k">class</span><span class="w"> </span><span class="nc">ReactionKineticsExperiment</span><span class="p">(</span><span class="n">Experiment</span><span class="p">):</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">create_model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">m</span> <span class="o">=</span> <span class="n">reaction_kinetics_model</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">m</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">finalize_model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span>

        <span class="c1"># Initial Conditions</span>

        <span class="n">m</span><span class="o">.</span><span class="n">CA</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">CA0</span><span class="p">)</span>
        <span class="n">m</span><span class="o">.</span><span class="n">CB</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="n">m</span><span class="o">.</span><span class="n">CC</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>


        <span class="k">return</span> <span class="n">m</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">label_model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span>

        <span class="n">m</span><span class="o">.</span><span class="n">experiment_outputs</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Suffix</span><span class="p">(</span><span class="n">direction</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">Suffix</span><span class="o">.</span><span class="n">LOCAL</span><span class="p">)</span>
        <span class="n">m</span><span class="o">.</span><span class="n">experiment_outputs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">CA</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;CA&#39;</span><span class="p">][</span><span class="n">ind</span><span class="p">])</span> <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]))</span>
        <span class="n">m</span><span class="o">.</span><span class="n">experiment_outputs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                <span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">CB</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;CB&#39;</span><span class="p">][</span><span class="n">ind</span><span class="p">])</span> <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]))</span>
        <span class="n">m</span><span class="o">.</span><span class="n">experiment_outputs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                <span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">CC</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;CC&#39;</span><span class="p">][</span><span class="n">ind</span><span class="p">])</span> <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]))</span>

        <span class="n">m</span><span class="o">.</span><span class="n">unknown_parameters</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Suffix</span><span class="p">(</span><span class="n">direction</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">Suffix</span><span class="o">.</span><span class="n">LOCAL</span><span class="p">)</span>
        <span class="n">m</span><span class="o">.</span><span class="n">unknown_parameters</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">pyo</span><span class="o">.</span><span class="n">ComponentUID</span><span class="p">(</span><span class="n">k</span><span class="p">))</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">A1</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">A2</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">E1</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">E2</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">m</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_labeled_model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_model</span><span class="p">()</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">finalize_model</span><span class="p">()</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_model</span><span class="p">()</span>
        <span class="c1"># m.pprint()</span>

        <span class="k">return</span> <span class="n">m</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Test model</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">data_dir</span> <span class="o">+</span> <span class="s1">&#39;parmest_20210609_data_exp1.csv&#39;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">reaction_kinetics_model</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="n">m</span><span class="o">.</span><span class="n">CA</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">CA0</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">CB</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">CC</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>

<span class="c1"># solve model</span>

<span class="n">solver</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">SolverFactory</span><span class="p">(</span><span class="s1">&#39;ipopt&#39;</span><span class="p">)</span>

<span class="c1"># solve model</span>
<span class="n">solver</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">tee</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># m.pprint()</span>

<span class="c1"># plot results</span>
<span class="n">CA</span> <span class="o">=</span> <span class="p">[</span><span class="n">pyo</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">CA</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">t</span><span class="p">]</span>
<span class="n">CB</span> <span class="o">=</span> <span class="p">[</span><span class="n">pyo</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">CB</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">t</span><span class="p">]</span>
<span class="n">CC</span> <span class="o">=</span> <span class="p">[</span><span class="n">pyo</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">CC</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">t</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">CA</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;$C_</span><span class="si">{A}</span><span class="s2">$&quot;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">CB</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;$C_</span><span class="si">{B}</span><span class="s2">$&quot;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-.&quot;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">CC</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;$C_</span><span class="si">{C}</span><span class="s2">$&quot;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time [hours]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Concentration [mol/L]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Batch Reactor Model&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    time    T  CA0        CA        CB        CC
0  0.000  250  0.5  0.476266  0.000000  0.000000
1  0.125  250  0.5  0.332309  0.133593  0.000000
2  0.250  250  0.5  0.295725  0.362016  0.092655
3  0.375  250  0.5  0.394806  0.131512  0.004404
4  0.500  250  0.5  0.167992  0.271682  0.031808
5  0.625  250  0.5  0.117872  0.313196  0.009108
6  0.750  250  0.5  0.117052  0.582722  0.000000
7  0.875  250  0.5  0.175373  0.224904  0.043844
8  1.000  250  0.5  0.130619  0.360287  0.194820
Ipopt 3.13.2: 

******************************************************************************
This program contains Ipopt, a library for large-scale nonlinear optimization.
 Ipopt is released as open source code under the Eclipse Public License (EPL).
         For more information visit http://projects.coin-or.org/Ipopt

This version of Ipopt was compiled from source code available at
    https://github.com/IDAES/Ipopt as part of the Institute for the Design of
    Advanced Energy Systems Process Systems Engineering Framework (IDAES PSE
    Framework) Copyright (c) 2018-2019. See https://github.com/IDAES/idaes-pse.

This version of Ipopt was compiled using HSL, a collection of Fortran codes
    for large-scale scientific computation.  All technical papers, sales and
    publicity material resulting from use of the HSL codes within IPOPT must
    contain the following acknowledgement:
        HSL, a collection of Fortran codes for large-scale scientific
        computation. See http://www.hsl.rl.ac.uk.
******************************************************************************

This is Ipopt version 3.13.2, running with linear solver ma27.

Number of nonzeros in equality constraint Jacobian...:       88
Number of nonzeros in inequality constraint Jacobian.:        0
Number of nonzeros in Lagrangian Hessian.............:       10

Total number of variables............................:       28
                     variables with only lower bounds:        0
                variables with lower and upper bounds:        4
                     variables with only upper bounds:        0
Total number of equality constraints.................:       24
Total number of inequality constraints...............:        0
        inequality constraints with only lower bounds:        0
   inequality constraints with lower and upper bounds:        0
        inequality constraints with only upper bounds:        0

iter    objective    inf_pr   inf_du lg(mu)  ||d||  lg(rg) alpha_du alpha_pr  ls
   0  0.0000000e+00 4.02e-01 0.00e+00  -1.0 0.00e+00    -  0.00e+00 0.00e+00   0
   1  0.0000000e+00 5.34e-07 0.00e+00  -1.0 4.01e-01    -  9.91e-01 1.00e+00h  1
   2  0.0000000e+00 6.14e-05 0.00e+00  -1.7 5.36e-02    -  1.00e+00 1.00e+00h  1
   3  0.0000000e+00 2.72e-07 0.00e+00  -3.8 3.41e-03    -  1.00e+00 1.00e+00h  1
   4  0.0000000e+00 7.12e-07 0.00e+00  -5.7 5.52e-03    -  1.00e+00 1.00e+00h  1
   5  0.0000000e+00 8.50e-09 0.00e+00  -8.6 6.04e-04    -  1.00e+00 1.00e+00h  1

Number of Iterations....: 5

                                   (scaled)                 (unscaled)
Objective...............:   0.0000000000000000e+00    0.0000000000000000e+00
Dual infeasibility......:   0.0000000000000000e+00    0.0000000000000000e+00
Constraint violation....:   8.4954715484641952e-09    8.4954715484641952e-09
Complementarity.........:   2.6198259016630073e-09    2.6198259016630073e-09
Overall NLP error.......:   8.4954715484641952e-09    8.4954715484641952e-09


Number of objective function evaluations             = 6
Number of objective gradient evaluations             = 6
Number of equality constraint evaluations            = 6
Number of inequality constraint evaluations          = 0
Number of equality constraint Jacobian evaluations   = 6
Number of inequality constraint Jacobian evaluations = 0
Number of Lagrangian Hessian evaluations             = 5
Total CPU secs in IPOPT (w/o function evaluations)   =      0.001
Total CPU secs in NLP function evaluations           =      0.000

EXIT: Optimal Solution Found.
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x1fcda72da60&gt;
</pre></div>
</div>
<img alt="../../_images/bde84c8267a211340cc09c1357a382fe7e7528b0d37ed1c8e7f3a6c3e502d117.png" src="../../_images/bde84c8267a211340cc09c1357a382fe7e7528b0d37ed1c8e7f3a6c3e502d117.png" />
</div>
</div>
</section>
</section>
<section id="parameter-estimation-with-a-single-dataset">
<h2><span class="section-number">5.1.4. </span>Parameter estimation with a single dataset<a class="headerlink" href="#parameter-estimation-with-a-single-dataset" title="Link to this heading">#</a></h2>
<p>Here, we will estimate parameters <span class="math notranslate nohighlight">\(A_1\)</span>, <span class="math notranslate nohighlight">\(A_2\)</span>, <span class="math notranslate nohighlight">\(E_1\)</span>, and <span class="math notranslate nohighlight">\(E_2\)</span> using data generated for a batch ‘experiment’ at 250 C with an inlet concentration of 0.5 mol/L of A.</p>
<p>The parameter estimation problem is solved with the least squares optimization scheme</p>
<p>The parameter estimation problem is solved with the least squares optimization scheme
$$</p>
<div class="amsmath math notranslate nohighlight" id="equation-fff70e56-7018-4a6e-a3de-414ed5a6ece4">
<span class="eqno">(5.1)<a class="headerlink" href="#equation-fff70e56-7018-4a6e-a3de-414ed5a6ece4" title="Permalink to this equation">#</a></span>\[\begin{align}
\begin{split}
    \min_{\hat{\theta}} \quad &amp; \sum_{i}^{} (y_i - f(x_i,\hat{\theta}))^2\\
    \textrm{s.t.} \quad &amp; \mathrm{bounds \ on} \ \theta\\
    &amp; \mathrm{other \ physical \ constraints}\\
\end{split}
\end{align}\]</div>
<p>$<span class="math notranslate nohighlight">\(
where \)</span>i<span class="math notranslate nohighlight">\( is used to index the datapoints in a dataset and \)</span>\hat{\theta}$ is the optimal set of parameter values that minimizes the prediction error.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># # read-in data from csv file</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">data_dir</span> <span class="o">+</span> <span class="s1">&#39;parmest_20210609_data_exp1.csv&#39;</span><span class="p">,</span><span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># # run parmest</span>

<span class="n">exp_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">data</span>

<span class="n">exp_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReactionKineticsExperiment</span><span class="p">(</span><span class="n">df</span><span class="p">))</span>

<span class="n">pest</span> <span class="o">=</span> <span class="n">parmest</span><span class="o">.</span><span class="n">Estimator</span><span class="p">(</span><span class="n">exp_list</span><span class="p">,</span> <span class="n">obj_function</span><span class="o">=</span><span class="s1">&#39;SSE&#39;</span><span class="p">,</span> <span class="n">tee</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

<span class="n">obj</span><span class="p">,</span> <span class="n">theta</span> <span class="o">=</span> <span class="n">pest</span><span class="o">.</span><span class="n">theta_est</span><span class="p">()</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">pest</span><span class="o">.</span><span class="n">ef_instance</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;===  Parameter values  ===&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;A1 = </span><span class="si">{:0.3f}</span><span class="s2"> 1/hr&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pyo</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">A1</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;A2 = </span><span class="si">{:0.3f}</span><span class="s2"> 1/hr&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pyo</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">A2</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;E1 = </span><span class="si">{:0.3f}</span><span class="s2"> kJ/mol&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pyo</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">E1</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;E2 = </span><span class="si">{:0.3f}</span><span class="s2"> kJ/mol&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pyo</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">E2</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Ipopt 3.13.2: 

******************************************************************************
This program contains Ipopt, a library for large-scale nonlinear optimization.
 Ipopt is released as open source code under the Eclipse Public License (EPL).
         For more information visit http://projects.coin-or.org/Ipopt

This version of Ipopt was compiled from source code available at
    https://github.com/IDAES/Ipopt as part of the Institute for the Design of
    Advanced Energy Systems Process Systems Engineering Framework (IDAES PSE
    Framework) Copyright (c) 2018-2019. See https://github.com/IDAES/idaes-pse.

This version of Ipopt was compiled using HSL, a collection of Fortran codes
    for large-scale scientific computation.  All technical papers, sales and
    publicity material resulting from use of the HSL codes within IPOPT must
    contain the following acknowledgement:
        HSL, a collection of Fortran codes for large-scale scientific
        computation. See http://www.hsl.rl.ac.uk.
******************************************************************************

This is Ipopt version 3.13.2, running with linear solver ma27.

Number of nonzeros in equality constraint Jacobian...:       88
Number of nonzeros in inequality constraint Jacobian.:        0
Number of nonzeros in Lagrangian Hessian.............:       34

Total number of variables............................:       28
                     variables with only lower bounds:        0
                variables with lower and upper bounds:        4
                     variables with only upper bounds:        0
Total number of equality constraints.................:       24
Total number of inequality constraints...............:        0
        inequality constraints with only lower bounds:        0
   inequality constraints with lower and upper bounds:        0
        inequality constraints with only upper bounds:        0

iter    objective    inf_pr   inf_du lg(mu)  ||d||  lg(rg) alpha_du alpha_pr  ls
   0  1.6338341e+00 4.02e-01 6.37e-01  -1.0 0.00e+00    -  0.00e+00 0.00e+00   0
   1  1.9026209e-01 2.34e-04 4.98e-03  -1.0 4.13e-01    -  9.86e-01 1.00e+00f  1
   2  1.8657853e-01 5.60e-04 2.39e-04  -1.0 1.99e-01    -  1.00e+00 1.00e+00h  1
   3  1.8638673e-01 4.98e-05 1.92e-05  -2.5 7.10e-02    -  1.00e+00 1.00e+00h  1
   4  1.8638598e-01 2.10e-07 1.36e-07  -3.8 4.52e-02    -  1.00e+00 1.00e+00h  1
   5  1.8638599e-01 2.23e-10 3.93e-11  -5.7 9.66e-03    -  1.00e+00 1.00e+00h  1
   6  1.8638599e-01 2.55e-12 2.09e-13  -8.6 1.05e-03    -  1.00e+00 1.00e+00h  1

Number of Iterations....: 6

                                   (scaled)                 (unscaled)
Objective...............:   1.8638598612196305e-01    1.8638598612196305e-01
Dual infeasibility......:   2.0863213371387894e-13    2.0863213371387894e-13
Constraint violation....:   2.5491830868418219e-12    2.5491830868418219e-12
Complementarity.........:   2.5255218792855822e-09    2.5255218792855822e-09
Overall NLP error.......:   2.5255218792855822e-09    2.5255218792855822e-09


Number of objective function evaluations             = 7
Number of objective gradient evaluations             = 7
Number of equality constraint evaluations            = 7
Number of inequality constraint evaluations          = 0
Number of equality constraint Jacobian evaluations   = 7
Number of inequality constraint Jacobian evaluations = 0
Number of Lagrangian Hessian evaluations             = 6
Total CPU secs in IPOPT (w/o function evaluations)   =      0.001
Total CPU secs in NLP function evaluations           =      0.000

EXIT: Optimal Solution Found.
===  Parameter values  ===
A1 = 200.209 1/hr
A2 = 400.037 1/hr
E1 = 9.640 kJ/mol
E2 = 14.939 kJ/mol
</pre></div>
</div>
</div>
</div>
</section>
<section id="parameter-estimation-with-multiple-datasets">
<h2><span class="section-number">5.1.5. </span>Parameter estimation with multiple datasets<a class="headerlink" href="#parameter-estimation-with-multiple-datasets" title="Link to this heading">#</a></h2>
<p>Here, we will estimate parameters <span class="math notranslate nohighlight">\(A_1\)</span>, <span class="math notranslate nohighlight">\(A_2\)</span>, <span class="math notranslate nohighlight">\(E_1\)</span>, and <span class="math notranslate nohighlight">\(E_2\)</span> using data generated for a batch ‘experiment’ at 250 C with an inlet concentration of 0.5 mol/L of A.</p>
<p>The parameter estimation problem is now defined to solve optimization problem where the objective function is the mean of the least square error between observed and calculated data for multiple experiments.</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align}
\begin{split}
    \min_{\hat{\theta}} \quad &amp; \frac{1}{N}\sum_{j}^{}\sum_{i}^{} (y_{j,i} - f(x_{j,i},\hat{\theta}))^2\\
    \textrm{s.t.} \quad &amp; \mathrm{bounds \ on} \ \theta\\
    &amp; \mathrm{other \ physical \ constraints}\\
\end{split}
\end{align}
\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(i\)</span> is used to index the datapoints in a dataset, <span class="math notranslate nohighlight">\(j\)</span> is an index on the dataset such that <span class="math notranslate nohighlight">\(j \in [1,N]\)</span> and <span class="math notranslate nohighlight">\(N\)</span> is the number of experiments conducted.</p>
<section id="generate-experiment-list">
<h3><span class="section-number">5.1.5.1. </span>Generate Experiment list<a class="headerlink" href="#generate-experiment-list" title="Link to this heading">#</a></h3>
<p>In the following cell, we define a function to generate a list of Experiments using the <code class="docutils literal notranslate"><span class="pre">Experiment</span></code> class.  For this, we read-in the list of file names generated earlier.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Make empty experiment list</span>
<span class="n">exp_list</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># Set generic file name to fill with data 1-16</span>
<span class="n">file_name_generic</span> <span class="o">=</span> <span class="n">data_dir</span> <span class="o">+</span> <span class="s1">&#39;parmest_20210609_data_exp</span><span class="si">{}</span><span class="s1">.csv&#39;</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">16</span><span class="p">):</span> <span class="c1">#making a list of different experiments, each exp has corresponding data</span>
  <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_name_generic</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
  <span class="c1"># print(df.head())</span>
  <span class="n">exp_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReactionKineticsExperiment</span><span class="p">(</span><span class="n">df</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id1">
<h3><span class="section-number">5.1.5.2. </span>Parameter estimation with parmest<a class="headerlink" href="#id1" title="Link to this heading">#</a></h3>
<p>In the following cell, we perform parameter estimation using parmest to solve the least squares problem defined in the Pyomo model.</p>
<p>In Google Colab, an error appears: ‘_PyDrive2ImportHook’ object has no attribute ‘find_spec’. This is being fixed by a recent patch to Pyomo: <a class="github reference external" href="https://github.com/Pyomo/pyomo/pull/3444">Pyomo/pyomo#3444</a>. Results generated using local run of software.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># run parmest</span>

<span class="n">pest</span> <span class="o">=</span> <span class="n">parmest</span><span class="o">.</span><span class="n">Estimator</span><span class="p">(</span><span class="n">exp_list</span><span class="p">,</span> <span class="n">obj_function</span><span class="o">=</span><span class="s1">&#39;SSE&#39;</span><span class="p">)</span>

<span class="n">obj</span><span class="p">,</span> <span class="n">theta</span> <span class="o">=</span> <span class="n">pest</span><span class="o">.</span><span class="n">theta_est</span><span class="p">()</span>

<span class="c1"># print(theta)</span>

<span class="c1">#model = pest.ef_instance</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">pest</span><span class="o">.</span><span class="n">ef_instance</span><span class="o">.</span><span class="n">Scenario0</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;===  Parameter values  ===&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;A1 = </span><span class="si">{:0.3f}</span><span class="s2"> 1/hr&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pyo</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">A1</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;A2 = </span><span class="si">{:0.3f}</span><span class="s2"> 1/hr&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pyo</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">A2</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;E1 = </span><span class="si">{:0.3f}</span><span class="s2"> kJ/mol&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pyo</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">E1</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;E2 = </span><span class="si">{:0.3f}</span><span class="s2"> kJ/mol&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pyo</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">E2</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>===  Parameter values  ===
A1 = 185.609 1/hr
A2 = 401.170 1/hr
E1 = 9.867 kJ/mol
E2 = 14.866 kJ/mol
</pre></div>
</div>
</div>
</div>
</section>
<section id="plotting-fitted-model-simulation-with-experimental-data">
<h3><span class="section-number">5.1.5.3. </span>Plotting fitted model simulation with ‘experimental’ data<a class="headerlink" href="#plotting-fitted-model-simulation-with-experimental-data" title="Link to this heading">#</a></h3>
<p>Next, we plot the ‘experimental’ data along with the profiles generated using the fitted kinetic model.  The symbols represent the ‘experimental’ data and the solid and dashed lines are the profiles generated using the fitted model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># list of temperatures</span>
<span class="n">T_vals</span> <span class="o">=</span> <span class="p">[</span><span class="mi">250</span><span class="p">,</span><span class="mi">300</span><span class="p">,</span><span class="mi">350</span><span class="p">,</span><span class="mi">400</span><span class="p">]</span> <span class="c1"># K</span>

<span class="c1"># list of initial concentrations of A</span>
<span class="n">CA0_vals</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.5</span><span class="p">,</span><span class="mf">2.0</span><span class="p">]</span> <span class="c1"># mol/L</span>

<span class="c1"># Parameter values from parameter estimation using parmest</span>
<span class="n">A1</span> <span class="o">=</span> <span class="n">theta</span><span class="p">[</span><span class="s1">&#39;A1&#39;</span><span class="p">]</span>
<span class="n">E1</span> <span class="o">=</span> <span class="n">theta</span><span class="p">[</span><span class="s1">&#39;E1&#39;</span><span class="p">]</span>
<span class="n">A2</span> <span class="o">=</span> <span class="n">theta</span><span class="p">[</span><span class="s1">&#39;A2&#39;</span><span class="p">]</span>
<span class="n">E2</span> <span class="o">=</span> <span class="n">theta</span><span class="p">[</span><span class="s1">&#39;E2&#39;</span><span class="p">]</span>


<span class="n">A_est1</span> <span class="o">=</span> <span class="p">[</span><span class="n">A1</span><span class="p">,</span> <span class="n">A2</span><span class="p">]</span>
<span class="n">A_est</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">A_est1</span><span class="p">)</span>

<span class="n">E_est1</span> <span class="o">=</span> <span class="p">[</span><span class="n">E1</span><span class="p">,</span> <span class="n">E2</span><span class="p">]</span>
<span class="n">E_est</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">E_est1</span><span class="p">)</span>

<span class="n">ctr</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">T</span> <span class="ow">in</span> <span class="n">T_vals</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">CA0</span> <span class="ow">in</span> <span class="n">CA0_vals</span><span class="p">:</span>
        <span class="c1"># generate concentration profiles using estimated parameter values</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">kinetics</span><span class="p">(</span><span class="n">A_est</span><span class="p">,</span> <span class="n">E_est</span><span class="p">,</span> <span class="n">T</span><span class="p">)</span>
        <span class="c1"># plot model-generated and &#39;experimental&#39; data</span>
        <span class="c1"># symbols for &#39;experimental&#39; data</span>
        <span class="c1"># solid and dashed lines for model-generated data</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_name_generic</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ctr</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">plot_exp</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">CA0</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="s1">&#39;Model prediction and experimental value at T = </span><span class="si">{}</span><span class="s1"> K and $C_</span><span class="si">{}</span><span class="s1">$ = </span><span class="si">{}</span><span class="s1"> mol/L&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">T</span><span class="p">,</span><span class="s1">&#39;A0&#39;</span><span class="p">,</span><span class="n">CA0</span><span class="p">))</span>
        <span class="n">ctr</span><span class="o">+=</span><span class="mi">1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/0ef38319d3cfe1ebff28e51772a41ddcc33e184975cec8665e79b5f4552d44d1.png" src="../../_images/0ef38319d3cfe1ebff28e51772a41ddcc33e184975cec8665e79b5f4552d44d1.png" />
<img alt="../../_images/8d9fdc6e00a66501c9f46e6f66b068771f85dba3f139ff04f922f87ff8ed7006.png" src="../../_images/8d9fdc6e00a66501c9f46e6f66b068771f85dba3f139ff04f922f87ff8ed7006.png" />
<img alt="../../_images/3638f88cc5b3fe1283bb512377e07e36b802c1123eda02bf3a1b684e4946afee.png" src="../../_images/3638f88cc5b3fe1283bb512377e07e36b802c1123eda02bf3a1b684e4946afee.png" />
<img alt="../../_images/12edee7529b4835afdedbe30182d91c85149eb853224409603ddedc1408a9981.png" src="../../_images/12edee7529b4835afdedbe30182d91c85149eb853224409603ddedc1408a9981.png" />
<img alt="../../_images/497f7e3c86840504fa1470388141683432280aa3ff931663e3a40c4035fa0734.png" src="../../_images/497f7e3c86840504fa1470388141683432280aa3ff931663e3a40c4035fa0734.png" />
<img alt="../../_images/f2747e3bb196af8ecc872ff94f1e045438a46fd6987d9738a103874829f57fbd.png" src="../../_images/f2747e3bb196af8ecc872ff94f1e045438a46fd6987d9738a103874829f57fbd.png" />
<img alt="../../_images/ffddf7fbb9367b6d093f01324adb6739252c3b10295892d03e2c16ab9beffc66.png" src="../../_images/ffddf7fbb9367b6d093f01324adb6739252c3b10295892d03e2c16ab9beffc66.png" />
<img alt="../../_images/d038fb193b0303df19ef6129aa9b64b69db0b1f3479819f3238cd89b8fdb3b0d.png" src="../../_images/d038fb193b0303df19ef6129aa9b64b69db0b1f3479819f3238cd89b8fdb3b0d.png" />
<img alt="../../_images/81f4f35b0eca7f8e7efc1e25c7ee3681caec52faa1a37000efbb42db2af53df6.png" src="../../_images/81f4f35b0eca7f8e7efc1e25c7ee3681caec52faa1a37000efbb42db2af53df6.png" />
<img alt="../../_images/64caa8074d4758497f848b952d9b7d73c92268067be5abdd5f2f2835e829a804.png" src="../../_images/64caa8074d4758497f848b952d9b7d73c92268067be5abdd5f2f2835e829a804.png" />
<img alt="../../_images/661094b959bd36fa4c6793d725930fe562c3e597e2aabcc7298a3658b881c068.png" src="../../_images/661094b959bd36fa4c6793d725930fe562c3e597e2aabcc7298a3658b881c068.png" />
<img alt="../../_images/72f959bc52468f120bdb4c3f8caa9c3f57b8c04f25640686f71aa621230221e5.png" src="../../_images/72f959bc52468f120bdb4c3f8caa9c3f57b8c04f25640686f71aa621230221e5.png" />
<img alt="../../_images/b3b4f35fcc178ddbece593d9ad4cc97f650666f493258cbd879a7e799a2c66bf.png" src="../../_images/b3b4f35fcc178ddbece593d9ad4cc97f650666f493258cbd879a7e799a2c66bf.png" />
<img alt="../../_images/3605fd9f7c77de92dedf3f4394edc577592bbd54d08ec0fe928d4fc9fe7334c5.png" src="../../_images/3605fd9f7c77de92dedf3f4394edc577592bbd54d08ec0fe928d4fc9fe7334c5.png" />
<img alt="../../_images/64a76aefbb1516077988a4f1bdf9e7a2eae0722317edc68561de5f73edaaff34.png" src="../../_images/64a76aefbb1516077988a4f1bdf9e7a2eae0722317edc68561de5f73edaaff34.png" />
<img alt="../../_images/d76b48bc798cf205b6d6ea0367b0c8b48703c0d47daa96aa17eb54c58dee4989.png" src="../../_images/d76b48bc798cf205b6d6ea0367b0c8b48703c0d47daa96aa17eb54c58dee4989.png" />
</div>
</div>
</section>
</section>
<section id="using-parmest-with-pyomo-dae">
<h2><span class="section-number">5.1.6. </span>Using <code class="docutils literal notranslate"><span class="pre">parmest</span></code> with <code class="docutils literal notranslate"><span class="pre">pyomo.dae</span></code><a class="headerlink" href="#using-parmest-with-pyomo-dae" title="Link to this heading">#</a></h2>
<p>In contrast to the approach above, we will now try to solve the model without the analytic solution for the concentrations using Pyomo.DAE.  To recap, the concentrations in a batch reactor evolve with time per the following differential equations:</p>
<div class="math notranslate nohighlight">
\[ \frac{d C_A}{dt} = r_A = -k_1 C_A \]</div>
<div class="math notranslate nohighlight">
\[ \frac{d C_B}{dt} = r_B = k_1 C_A - k_2 C_B \]</div>
<div class="math notranslate nohighlight">
\[ \frac{d C_C}{dt} = r_C = k_2 C_B \]</div>
<p>This is a linear system of differential equations. Assuming the feed is only species <span class="math notranslate nohighlight">\(A\)</span>, i.e.,</p>
<div class="math notranslate nohighlight">
\[C_A(t=0) = C_{A0} \quad C_B(t=0) = 0 \quad C_C(t=0) = 0\]</div>
<p>In the following cell, we define a function to define and return the Pyomo DAE model (dynamic mode) for the kinetic model to be used for parameter estimation.  In this model, the rate equations are presented in terms of linear differential equations.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pyomo.contrib.parmest.parmest</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">parmest</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyomo.contrib.parmest.experiment</span><span class="w"> </span><span class="kn">import</span> <span class="n">Experiment</span>

<span class="k">def</span><span class="w"> </span><span class="nf">reaction_kinetics_model_dae</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>

    <span class="c1"># define Pyomo model</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">ConcreteModel</span><span class="p">()</span>
    <span class="n">m</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># K</span>
    <span class="n">m</span><span class="o">.</span><span class="n">CA0</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;CA0&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># mol/L</span>
    <span class="n">m</span><span class="o">.</span><span class="n">R</span> <span class="o">=</span> <span class="mf">8.31446261815324</span> <span class="c1"># J / K / mol</span>

    <span class="c1"># # define &#39;experimental&#39; data timesteps as Pyomo set</span>
    <span class="n">m</span><span class="o">.</span><span class="n">t</span> <span class="o">=</span> <span class="n">dae</span><span class="o">.</span><span class="n">ContinuousSet</span><span class="p">(</span><span class="n">initialize</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">bounds</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>

    <span class="c1"># Kinetic parameters to be fitted defined as Pyomo variables</span>
    <span class="c1"># Initialized by &#39;true&#39; values</span>
    <span class="n">m</span><span class="o">.</span><span class="n">A1</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="mi">300</span><span class="p">))</span> <span class="c1"># 1/hr</span>
    <span class="n">m</span><span class="o">.</span><span class="n">A2</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">300</span><span class="p">,</span><span class="mi">500</span><span class="p">))</span> <span class="c1"># 1/hr</span>
    <span class="n">m</span><span class="o">.</span><span class="n">E1</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span> <span class="c1"># kJ/mol</span>
    <span class="n">m</span><span class="o">.</span><span class="n">E2</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">30</span><span class="p">))</span> <span class="c1"># kJ/mol</span>

    <span class="c1"># Concentration variables indexed by time</span>
    <span class="n">m</span><span class="o">.</span><span class="n">CA</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">initialize</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">CA0</span><span class="p">)</span> <span class="c1"># mol/L</span>
    <span class="n">m</span><span class="o">.</span><span class="n">CB</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">initialize</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="c1"># mol/L</span>
    <span class="n">m</span><span class="o">.</span><span class="n">CC</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">initialize</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="c1"># mol/L</span>

    <span class="c1"># Derivatives of concentration</span>
    <span class="n">m</span><span class="o">.</span><span class="n">dCA</span> <span class="o">=</span> <span class="n">dae</span><span class="o">.</span><span class="n">DerivativeVar</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">CA</span><span class="p">,</span> <span class="n">wrt</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">t</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">dCB</span> <span class="o">=</span> <span class="n">dae</span><span class="o">.</span><span class="n">DerivativeVar</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">CB</span><span class="p">,</span> <span class="n">wrt</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">t</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">dCC</span> <span class="o">=</span> <span class="n">dae</span><span class="o">.</span><span class="n">DerivativeVar</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">CC</span><span class="p">,</span> <span class="n">wrt</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">t</span><span class="p">)</span>


    <span class="c1"># kinetic rate constants from Arrhenius equation</span>
    <span class="n">m</span><span class="o">.</span><span class="n">k1</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Expression</span><span class="p">(</span><span class="n">rule</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">A1</span> <span class="o">*</span> <span class="n">pyo</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">m</span><span class="o">.</span><span class="n">E1</span><span class="o">*</span><span class="mi">1000</span><span class="o">/</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">R</span><span class="o">*</span><span class="n">m</span><span class="o">.</span><span class="n">T</span><span class="p">)))</span> <span class="c1"># 1/hr</span>
    <span class="n">m</span><span class="o">.</span><span class="n">k2</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Expression</span><span class="p">(</span><span class="n">rule</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">A2</span> <span class="o">*</span> <span class="n">pyo</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">m</span><span class="o">.</span><span class="n">E2</span><span class="o">*</span><span class="mi">1000</span><span class="o">/</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">R</span><span class="o">*</span><span class="n">m</span><span class="o">.</span><span class="n">T</span><span class="p">)))</span> <span class="c1"># 1/hr</span>

    <span class="c1"># Constraints to change concentrations based on kinetics</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">conc_A</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">i</span><span class="p">):</span>

            <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">dCA</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span> <span class="n">m</span><span class="o">.</span><span class="n">k1</span> <span class="o">*</span> <span class="n">m</span><span class="o">.</span><span class="n">CA</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">m</span><span class="o">.</span><span class="n">CA_rate</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">t</span><span class="p">,</span><span class="n">rule</span><span class="o">=</span><span class="n">conc_A</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">conc_B</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">i</span><span class="p">):</span>

            <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">dCB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">m</span><span class="o">.</span><span class="n">k1</span> <span class="o">*</span> <span class="n">m</span><span class="o">.</span><span class="n">CA</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">m</span><span class="o">.</span><span class="n">k2</span> <span class="o">*</span> <span class="n">m</span><span class="o">.</span><span class="n">CB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">m</span><span class="o">.</span><span class="n">CB_rate</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">t</span><span class="p">,</span><span class="n">rule</span><span class="o">=</span><span class="n">conc_B</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">conc_C</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">i</span><span class="p">):</span>

            <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">dCC</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">m</span><span class="o">.</span><span class="n">k2</span> <span class="o">*</span> <span class="n">m</span><span class="o">.</span><span class="n">CB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">m</span><span class="o">.</span><span class="n">CC_rate</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">t</span><span class="p">,</span><span class="n">rule</span><span class="o">=</span><span class="n">conc_C</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">m</span>

<span class="k">class</span><span class="w"> </span><span class="nc">ReactionKineticsExperiment_dae</span><span class="p">(</span><span class="n">Experiment</span><span class="p">):</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span> <span class="c1"># , experiment_number):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">create_model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">m</span> <span class="o">=</span> <span class="n">reaction_kinetics_model_dae</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">m</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">finalize_model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span>

        <span class="c1"># Initial Conditions</span>
        <span class="n">m</span><span class="o">.</span><span class="n">CA0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;CA0&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">m</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">m</span><span class="o">.</span><span class="n">CA</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">CA0</span><span class="p">)</span>
        <span class="n">m</span><span class="o">.</span><span class="n">CB</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="n">m</span><span class="o">.</span><span class="n">CC</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>


        <span class="c1"># Initialize the model with simulator</span>
        <span class="n">sim</span> <span class="o">=</span> <span class="n">dae</span><span class="o">.</span><span class="n">Simulator</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">package</span><span class="o">=</span><span class="s1">&#39;casadi&#39;</span><span class="p">)</span>
        <span class="n">tsim</span><span class="p">,</span> <span class="n">profiles</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">numpoints</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">integrator</span><span class="o">=</span><span class="s1">&#39;idas&#39;</span><span class="p">)</span>
                
        <span class="n">sim</span><span class="o">.</span><span class="n">initialize_model</span><span class="p">()</span>

        <span class="c1"># Discretize model using collocation</span>
        <span class="n">discretizer</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">TransformationFactory</span><span class="p">(</span><span class="s1">&#39;dae.collocation&#39;</span><span class="p">)</span>
        <span class="n">discretizer</span><span class="o">.</span><span class="n">apply_to</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">wrt</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">nfe</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span> <span class="n">ncp</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">scheme</span><span class="o">=</span><span class="s1">&#39;LAGRANGE-RADAU&#39;</span><span class="p">)</span>


        <span class="k">return</span> <span class="n">m</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">label_model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span>

        <span class="n">m</span><span class="o">.</span><span class="n">experiment_outputs</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Suffix</span><span class="p">(</span><span class="n">direction</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">Suffix</span><span class="o">.</span><span class="n">LOCAL</span><span class="p">)</span>
        <span class="n">m</span><span class="o">.</span><span class="n">experiment_outputs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">CA</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;CA&#39;</span><span class="p">][</span><span class="n">ind</span><span class="p">])</span> <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]))</span>
        <span class="n">m</span><span class="o">.</span><span class="n">experiment_outputs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                <span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">CB</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;CB&#39;</span><span class="p">][</span><span class="n">ind</span><span class="p">])</span> <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]))</span>
        <span class="n">m</span><span class="o">.</span><span class="n">experiment_outputs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                <span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">CC</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;CC&#39;</span><span class="p">][</span><span class="n">ind</span><span class="p">])</span> <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]))</span>

        <span class="n">m</span><span class="o">.</span><span class="n">unknown_parameters</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Suffix</span><span class="p">(</span><span class="n">direction</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">Suffix</span><span class="o">.</span><span class="n">LOCAL</span><span class="p">)</span>
        <span class="n">m</span><span class="o">.</span><span class="n">unknown_parameters</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">pyo</span><span class="o">.</span><span class="n">ComponentUID</span><span class="p">(</span><span class="n">k</span><span class="p">))</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">A1</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">A2</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">E1</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">E2</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">m</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_labeled_model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_model</span><span class="p">()</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">finalize_model</span><span class="p">()</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_model</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">m</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Test model</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">data_dir</span> <span class="o">+</span> <span class="s1">&#39;parmest_20210609_data_exp1.csv&#39;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">reaction_kinetics_model_dae</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="c1"># discretize</span>
<span class="n">discretizer</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">TransformationFactory</span><span class="p">(</span><span class="s1">&#39;dae.collocation&#39;</span><span class="p">)</span>
<span class="n">discretizer</span><span class="o">.</span><span class="n">apply_to</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">wrt</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">nfe</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span> <span class="n">ncp</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">scheme</span><span class="o">=</span><span class="s1">&#39;LAGRANGE-RADAU&#39;</span><span class="p">)</span>

<span class="c1"># Fix initial conditions in OG model</span>
<span class="n">m</span><span class="o">.</span><span class="n">A1</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span> <span class="c1"># 1/hr</span>
<span class="n">m</span><span class="o">.</span><span class="n">A2</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span> <span class="c1"># 1/hr</span>
<span class="n">m</span><span class="o">.</span><span class="n">E1</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="c1"># kJ/mol</span>
<span class="n">m</span><span class="o">.</span><span class="n">E2</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span> <span class="c1"># kJ/mol</span>

<span class="n">m</span><span class="o">.</span><span class="n">CA</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">CA0</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">CB</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">CC</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>

<span class="c1"># # solve model</span>
<span class="n">solver</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">SolverFactory</span><span class="p">(</span><span class="s1">&#39;ipopt&#39;</span><span class="p">)</span>

<span class="c1"># solve model</span>
<span class="n">solver</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">tee</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># m.pprint()</span>

<span class="c1"># plot results</span>
<span class="n">CA</span> <span class="o">=</span> <span class="p">[</span><span class="n">pyo</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">CA</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">t</span><span class="p">]</span>
<span class="n">CB</span> <span class="o">=</span> <span class="p">[</span><span class="n">pyo</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">CB</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">t</span><span class="p">]</span>
<span class="n">CC</span> <span class="o">=</span> <span class="p">[</span><span class="n">pyo</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">CC</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">t</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">CA</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;$C_</span><span class="si">{A}</span><span class="s2">$&quot;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">CB</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;$C_</span><span class="si">{B}</span><span class="s2">$&quot;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-.&quot;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">CC</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;$C_</span><span class="si">{C}</span><span class="s2">$&quot;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time [hours]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Concentration [mol/L]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Batch Reactor Model&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    time    T  CA0        CA        CB        CC
0  0.000  250  0.5  0.476266  0.000000  0.000000
1  0.125  250  0.5  0.332309  0.133593  0.000000
2  0.250  250  0.5  0.295725  0.362016  0.092655
3  0.375  250  0.5  0.394806  0.131512  0.004404
4  0.500  250  0.5  0.167992  0.271682  0.031808
5  0.625  250  0.5  0.117872  0.313196  0.009108
6  0.750  250  0.5  0.117052  0.582722  0.000000
7  0.875  250  0.5  0.175373  0.224904  0.043844
8  1.000  250  0.5  0.130619  0.360287  0.194820
Ipopt 3.13.2: 

******************************************************************************
This program contains Ipopt, a library for large-scale nonlinear optimization.
 Ipopt is released as open source code under the Eclipse Public License (EPL).
         For more information visit http://projects.coin-or.org/Ipopt

This version of Ipopt was compiled from source code available at
    https://github.com/IDAES/Ipopt as part of the Institute for the Design of
    Advanced Energy Systems Process Systems Engineering Framework (IDAES PSE
    Framework) Copyright (c) 2018-2019. See https://github.com/IDAES/idaes-pse.

This version of Ipopt was compiled using HSL, a collection of Fortran codes
    for large-scale scientific computation.  All technical papers, sales and
    publicity material resulting from use of the HSL codes within IPOPT must
    contain the following acknowledgement:
        HSL, a collection of Fortran codes for large-scale scientific
        computation. See http://www.hsl.rl.ac.uk.
******************************************************************************

This is Ipopt version 3.13.2, running with linear solver ma27.

Number of nonzeros in equality constraint Jacobian...:     1991
Number of nonzeros in inequality constraint Jacobian.:        0
Number of nonzeros in Lagrangian Hessian.............:        0

Total number of variables............................:      483
                     variables with only lower bounds:        0
                variables with lower and upper bounds:        0
                     variables with only upper bounds:        0
Total number of equality constraints.................:      483
Total number of inequality constraints...............:        0
        inequality constraints with only lower bounds:        0
   inequality constraints with lower and upper bounds:        0
        inequality constraints with only upper bounds:        0

iter    objective    inf_pr   inf_du lg(mu)  ||d||  lg(rg) alpha_du alpha_pr  ls
   0  0.0000000e+00 8.14e-01 0.00e+00  -1.0 0.00e+00    -  0.00e+00 0.00e+00   0
   1  0.0000000e+00 2.84e-14 0.00e+00  -1.7 8.14e-01    -  1.00e+00 1.00e+00h  1

Number of Iterations....: 1

                                   (scaled)                 (unscaled)
Objective...............:   0.0000000000000000e+00    0.0000000000000000e+00
Dual infeasibility......:   0.0000000000000000e+00    0.0000000000000000e+00
Constraint violation....:   1.0945572278273075e-14    2.8421709430404007e-14
Complementarity.........:   0.0000000000000000e+00    0.0000000000000000e+00
Overall NLP error.......:   1.0945572278273075e-14    2.8421709430404007e-14


Number of objective function evaluations             = 2
Number of objective gradient evaluations             = 2
Number of equality constraint evaluations            = 2
Number of inequality constraint evaluations          = 0
Number of equality constraint Jacobian evaluations   = 2
Number of inequality constraint Jacobian evaluations = 0
Number of Lagrangian Hessian evaluations             = 1
Total CPU secs in IPOPT (w/o function evaluations)   =      0.003
Total CPU secs in NLP function evaluations           =      0.000

EXIT: Optimal Solution Found.
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x1fcd99d1f70&gt;
</pre></div>
</div>
<img alt="../../_images/a5cd01a0716c9d7c868250d5891f7b1c261dcae1733fbaa5a1777e277e040f19.png" src="../../_images/a5cd01a0716c9d7c868250d5891f7b1c261dcae1733fbaa5a1777e277e040f19.png" />
</div>
</div>
<section id="id2">
<h3><span class="section-number">5.1.6.1. </span>Parameter estimation with parmest<a class="headerlink" href="#id2" title="Link to this heading">#</a></h3>
<p>In the following cell, we perform parameter estimation using parmest to solve the least squares problem defined in the Pyomo dynamic model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># list of temperatures</span>
<span class="n">T_vals</span> <span class="o">=</span> <span class="p">[</span><span class="mi">250</span><span class="p">,</span><span class="mi">300</span><span class="p">,</span><span class="mi">350</span><span class="p">,</span><span class="mi">400</span><span class="p">]</span> <span class="c1"># K</span>

<span class="c1"># list of initial concentrations of A</span>
<span class="n">CA0_vals</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.5</span><span class="p">,</span><span class="mf">2.0</span><span class="p">]</span> <span class="c1"># mol/L</span>

<span class="c1"># run parmest</span>

<span class="n">exp_list</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">16</span><span class="p">):</span> <span class="c1">#making a list of different experiments, each exp has corresponding data</span>
  <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_name_generic</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
  <span class="c1"># print(df.head())</span>
  <span class="n">exp_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReactionKineticsExperiment_dae</span><span class="p">(</span><span class="n">df</span><span class="p">))</span>

<span class="n">pest</span> <span class="o">=</span> <span class="n">parmest</span><span class="o">.</span><span class="n">Estimator</span><span class="p">(</span><span class="n">exp_list</span><span class="p">,</span> <span class="n">obj_function</span><span class="o">=</span><span class="s1">&#39;SSE&#39;</span><span class="p">)</span> <span class="c1">#, tee = True)</span>

<span class="n">obj</span><span class="p">,</span> <span class="n">theta</span> <span class="o">=</span> <span class="n">pest</span><span class="o">.</span><span class="n">theta_est</span><span class="p">()</span>

<span class="c1"># print(theta)</span>

<span class="c1">#model = pest.ef_instance</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">pest</span><span class="o">.</span><span class="n">ef_instance</span><span class="o">.</span><span class="n">Scenario0</span> <span class="c1"># For multiple experiments, Scenarios are generated</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;===  Parameter values  ===&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;A1 = </span><span class="si">{:0.3f}</span><span class="s2"> 1/hr&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pyo</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">A1</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;A2 = </span><span class="si">{:0.3f}</span><span class="s2"> 1/hr&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pyo</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">A2</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;E1 = </span><span class="si">{:0.3f}</span><span class="s2"> kJ/mol&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pyo</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">E1</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;E2 = </span><span class="si">{:0.3f}</span><span class="s2"> kJ/mol&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pyo</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">E2</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>===  Parameter values  ===
A1 = 185.609 1/hr
A2 = 401.170 1/hr
E1 = 9.867 kJ/mol
E2 = 14.866 kJ/mol
</pre></div>
</div>
</div>
</div>
</section>
<section id="id3">
<h3><span class="section-number">5.1.6.2. </span>Plotting fitted model simulation with ‘experimental’ data<a class="headerlink" href="#id3" title="Link to this heading">#</a></h3>
<p>Next, we plot the ‘experimental’ data along with the profiles generated using the fitted kinetic model.  The symbols represent the ‘experimental’ data and the solid and dashed lines are the profiles generated using the fitted model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Parameter values from parameter estimation using parmest</span>
<span class="n">A1</span> <span class="o">=</span> <span class="n">theta</span><span class="p">[</span><span class="s1">&#39;A1&#39;</span><span class="p">]</span>
<span class="n">E1</span> <span class="o">=</span> <span class="n">theta</span><span class="p">[</span><span class="s1">&#39;E1&#39;</span><span class="p">]</span>
<span class="n">A2</span> <span class="o">=</span> <span class="n">theta</span><span class="p">[</span><span class="s1">&#39;A2&#39;</span><span class="p">]</span>
<span class="n">E2</span> <span class="o">=</span> <span class="n">theta</span><span class="p">[</span><span class="s1">&#39;E2&#39;</span><span class="p">]</span>


<span class="n">A_est1</span> <span class="o">=</span> <span class="p">[</span><span class="n">A1</span><span class="p">,</span> <span class="n">A2</span><span class="p">]</span>
<span class="n">A_est</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">A_est1</span><span class="p">)</span>

<span class="n">E_est1</span> <span class="o">=</span> <span class="p">[</span><span class="n">E1</span><span class="p">,</span> <span class="n">E2</span><span class="p">]</span>
<span class="n">E_est</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">E_est1</span><span class="p">)</span>

<span class="n">ctr</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">T</span> <span class="ow">in</span> <span class="n">T_vals</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">CA0</span> <span class="ow">in</span> <span class="n">CA0_vals</span><span class="p">:</span>
        <span class="c1"># generate concentration profiles using estimated parameter values</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">kinetics</span><span class="p">(</span><span class="n">A_est</span><span class="p">,</span> <span class="n">E_est</span><span class="p">,</span> <span class="n">T</span><span class="p">)</span>
        <span class="c1"># plot model-generated and &#39;experimental&#39; data</span>
        <span class="c1"># symbols for &#39;experimental&#39; data</span>
        <span class="c1"># solid and dashed lines for model-generated data</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_name_generic</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ctr</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">plot_exp</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">CA0</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="s1">&#39;Model prediction and experimental value at T = </span><span class="si">{}</span><span class="s1"> K and $C_</span><span class="si">{}</span><span class="s1">$ = </span><span class="si">{}</span><span class="s1"> mol/L&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">T</span><span class="p">,</span><span class="s1">&#39;A0&#39;</span><span class="p">,</span><span class="n">CA0</span><span class="p">))</span>
        <span class="n">ctr</span><span class="o">+=</span><span class="mi">1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/306b441db930fe91a203b07d187303f08a90ea08642a7ed4db41dcf939e366b7.png" src="../../_images/306b441db930fe91a203b07d187303f08a90ea08642a7ed4db41dcf939e366b7.png" />
<img alt="../../_images/8d9fdc6e00a66501c9f46e6f66b068771f85dba3f139ff04f922f87ff8ed7006.png" src="../../_images/8d9fdc6e00a66501c9f46e6f66b068771f85dba3f139ff04f922f87ff8ed7006.png" />
<img alt="../../_images/3638f88cc5b3fe1283bb512377e07e36b802c1123eda02bf3a1b684e4946afee.png" src="../../_images/3638f88cc5b3fe1283bb512377e07e36b802c1123eda02bf3a1b684e4946afee.png" />
<img alt="../../_images/7ee02da728b22fbe8bb51e0ab203317429e93407d708d0d3918083f2e10d3776.png" src="../../_images/7ee02da728b22fbe8bb51e0ab203317429e93407d708d0d3918083f2e10d3776.png" />
<img alt="../../_images/497f7e3c86840504fa1470388141683432280aa3ff931663e3a40c4035fa0734.png" src="../../_images/497f7e3c86840504fa1470388141683432280aa3ff931663e3a40c4035fa0734.png" />
<img alt="../../_images/f2747e3bb196af8ecc872ff94f1e045438a46fd6987d9738a103874829f57fbd.png" src="../../_images/f2747e3bb196af8ecc872ff94f1e045438a46fd6987d9738a103874829f57fbd.png" />
<img alt="../../_images/ffddf7fbb9367b6d093f01324adb6739252c3b10295892d03e2c16ab9beffc66.png" src="../../_images/ffddf7fbb9367b6d093f01324adb6739252c3b10295892d03e2c16ab9beffc66.png" />
<img alt="../../_images/d038fb193b0303df19ef6129aa9b64b69db0b1f3479819f3238cd89b8fdb3b0d.png" src="../../_images/d038fb193b0303df19ef6129aa9b64b69db0b1f3479819f3238cd89b8fdb3b0d.png" />
<img alt="../../_images/81f4f35b0eca7f8e7efc1e25c7ee3681caec52faa1a37000efbb42db2af53df6.png" src="../../_images/81f4f35b0eca7f8e7efc1e25c7ee3681caec52faa1a37000efbb42db2af53df6.png" />
<img alt="../../_images/64caa8074d4758497f848b952d9b7d73c92268067be5abdd5f2f2835e829a804.png" src="../../_images/64caa8074d4758497f848b952d9b7d73c92268067be5abdd5f2f2835e829a804.png" />
<img alt="../../_images/84cb5a7f65a679df487dd12da9a79c7a6cacf04e1ab45594d2f3a18defaaa0b6.png" src="../../_images/84cb5a7f65a679df487dd12da9a79c7a6cacf04e1ab45594d2f3a18defaaa0b6.png" />
<img alt="../../_images/72f959bc52468f120bdb4c3f8caa9c3f57b8c04f25640686f71aa621230221e5.png" src="../../_images/72f959bc52468f120bdb4c3f8caa9c3f57b8c04f25640686f71aa621230221e5.png" />
<img alt="../../_images/406c867bd7160f4e7efa8bf2a9bf9923899d4faaabee622b4a585435dbbfc3d3.png" src="../../_images/406c867bd7160f4e7efa8bf2a9bf9923899d4faaabee622b4a585435dbbfc3d3.png" />
<img alt="../../_images/31033c0573f02f640b00bbc0b24d4bfa960ea492d7a51c92fb90de4e3f910cf7.png" src="../../_images/31033c0573f02f640b00bbc0b24d4bfa960ea492d7a51c92fb90de4e3f910cf7.png" />
<img alt="../../_images/64a76aefbb1516077988a4f1bdf9e7a2eae0722317edc68561de5f73edaaff34.png" src="../../_images/64a76aefbb1516077988a4f1bdf9e7a2eae0722317edc68561de5f73edaaff34.png" />
<img alt="../../_images/bdb962569afe275a4405b658a1010b83077bce4ffa02fd0bbc2e9afa1ae24015.png" src="../../_images/bdb962569afe275a4405b658a1010b83077bce4ffa02fd0bbc2e9afa1ae24015.png" />
</div>
</div>
</section>
</section>
<section id="local-uncertainty-analysis">
<h2><span class="section-number">5.1.7. </span>Local uncertainty analysis<a class="headerlink" href="#local-uncertainty-analysis" title="Link to this heading">#</a></h2>
<section id="covariance-matrix">
<h3><span class="section-number">5.1.7.1. </span>Covariance matrix<a class="headerlink" href="#covariance-matrix" title="Link to this heading">#</a></h3>
<p>The parameter covariance matrix is calculated using the reduced Hessian approach. Using <code class="docutils literal notranslate"><span class="pre">parmest</span></code>, the covariance matrix can be calculated by setting optional argument <code class="docutils literal notranslate"><span class="pre">calc_cov</span></code> to <code class="docutils literal notranslate"><span class="pre">True</span></code>. More information on this approach can be found here: <a class="reference external" href="https://doi.org/10.1002/aic.16242">https://doi.org/10.1002/aic.16242</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># run parmest</span>

<span class="n">exp_list</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">16</span><span class="p">):</span> <span class="c1">#making a list of different experiments, each exp has corresponding data</span>
  <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_name_generic</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
  <span class="c1"># print(df.head())</span>
  <span class="n">exp_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReactionKineticsExperiment</span><span class="p">(</span><span class="n">df</span><span class="p">))</span>

<span class="n">pest</span> <span class="o">=</span> <span class="n">parmest</span><span class="o">.</span><span class="n">Estimator</span><span class="p">(</span><span class="n">exp_list</span><span class="p">,</span> <span class="n">obj_function</span><span class="o">=</span><span class="s1">&#39;SSE&#39;</span><span class="p">)</span>

<span class="n">obj</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">cov</span> <span class="o">=</span> <span class="n">pest</span><span class="o">.</span><span class="n">theta_est</span><span class="p">(</span><span class="n">calc_cov</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cov_n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">))</span>
<span class="c1"># print(cov)</span>

<span class="c1"># print(theta)</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">pest</span><span class="o">.</span><span class="n">ef_instance</span><span class="o">.</span><span class="n">Scenario0</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;===  Parameter values  ===&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;A1 = </span><span class="si">{:0.3f}</span><span class="s2"> 1/hr&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pyo</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">A1</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;A2 = </span><span class="si">{:0.3f}</span><span class="s2"> 1/hr&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pyo</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">A2</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;E1 = </span><span class="si">{:0.3f}</span><span class="s2"> kJ/mol&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pyo</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">E1</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;E2 = </span><span class="si">{:0.3f}</span><span class="s2"> kJ/mol&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pyo</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">E2</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>===  Parameter values  ===
A1 = 185.609 1/hr
A2 = 401.170 1/hr
E1 = 9.867 kJ/mol
E2 = 14.866 kJ/mol
</pre></div>
</div>
</div>
</div>
</section>
<section id="parameter-identifiability">
<h3><span class="section-number">5.1.7.2. </span>Parameter identifiability<a class="headerlink" href="#parameter-identifiability" title="Link to this heading">#</a></h3>
<p>The Fisher information matrix, <span class="math notranslate nohighlight">\(FIM\)</span>, is calculated as the inverse of the parameter covariance matrix:
<span class="math notranslate nohighlight">\(FIM = {(Cov.)}^{-1}\)</span></p>
<p>Eigen decomposition of <span class="math notranslate nohighlight">\(FIM\)</span> following <span class="math notranslate nohighlight">\(FIM = v \lambda {v}^{-1}\)</span> gives eigenvector matrix <span class="math notranslate nohighlight">\(v\)</span> and <span class="math notranslate nohighlight">\(\lambda\)</span> is the diagonal matrix of eigenvalues. Column <span class="math notranslate nohighlight">\(i\)</span> in <span class="math notranslate nohighlight">\(v\)</span> is the eigenvector corresponding to the <span class="math notranslate nohighlight">\(i\)</span>-th eigenvalue. Further, each element of the eigenvector corresponds to the fitted parameters in order in which they appear in in <code class="docutils literal notranslate"><span class="pre">theta_names</span></code>. The magnitude of each element of an eigenvector denotes the contribution of the parameters on the direciton of the unit vector.</p>
<p>The eigenvector corresponding to the smallest eigenvalue denotes the direction of least variance in the parameter space.  The parameter that corresponds to the major contributor in the eigenvector, then, has the lowest impact on model fit quality. Thus, this parameter is considered sloppy and fixing it’s value will not affect overall model behavior.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Fisher information matrix can be computed using the inverse of the reduced Hessian</span>
<span class="c1"># defining the names of the parameters in a list</span>
<span class="n">theta_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;A1&#39;</span><span class="p">,</span><span class="s1">&#39;A2&#39;</span><span class="p">,</span><span class="s1">&#39;E1&#39;</span><span class="p">,</span><span class="s1">&#39;E2&#39;</span><span class="p">]</span>

<span class="n">fim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">cov</span><span class="p">)</span>

<span class="c1"># Eigen decomposition of the Fisher information matrix</span>
<span class="n">eig_values</span><span class="p">,</span> <span class="n">eig_vectors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eig</span><span class="p">(</span><span class="n">fim</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">eig</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">eig_values</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;***************************************************************&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Eigen value: </span><span class="si">{:0.3e}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">eig</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;=== Eigen vector elements with correspondng parameter names ===</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;------------------------------&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;| Vector element | Parameter |&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;------------------------------&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">j</span><span class="p">,</span><span class="n">theta_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">theta_names</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">eig_vectors</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;|   </span><span class="si">{:0.3e}</span><span class="s1">   |    </span><span class="si">{}</span><span class="s1">     |&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">eig_vectors</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">],</span><span class="n">theta_name</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;|   </span><span class="si">{:0.3e}</span><span class="s1">    |    </span><span class="si">{}</span><span class="s1">     |&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">eig_vectors</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">],</span><span class="n">theta_name</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>***************************************************************

Eigen value: 6.495e+00

=== Eigen vector elements with correspondng parameter names ===

------------------------------
| Vector element | Parameter |
------------------------------
|   2.017e-01    |    A1     |
|   9.794e-01    |    A2     |
|   6.919e-03    |    E1     |
|   -1.150e-03   |    E2     |


***************************************************************

Eigen value: 3.670e+00

=== Eigen vector elements with correspondng parameter names ===

------------------------------
| Vector element | Parameter |
------------------------------
|   9.794e-01    |    A1     |
|   -2.017e-01   |    A2     |
|   -5.644e-04   |    E1     |
|   -1.263e-02   |    E2     |


***************************************************************

Eigen value: 2.688e-06

=== Eigen vector elements with correspondng parameter names ===

------------------------------
| Vector element | Parameter |
------------------------------
|   -1.519e-03   |    A1     |
|   -6.805e-03   |    A2     |
|   9.985e-01    |    E1     |
|   -5.373e-02   |    E2     |


***************************************************************

Eigen value: 2.394e-05

=== Eigen vector elements with correspondng parameter names ===

------------------------------
| Vector element | Parameter |
------------------------------
|   -1.254e-02   |    A1     |
|   1.789e-03    |    A2     |
|   -5.373e-02   |    E1     |
|   -9.985e-01   |    E2     |
</pre></div>
</div>
</div>
</div>
<p>Looking at the eigenvalues and corresponding eigenvectors, we can see that parameters A2 and A1 (in order) have the largest contributions to the direction of the eigenvector corresponding to the smallest eigenvalue.  Therefore, as discussed above, we can conclude from this analysis that parameter A2 is the least identifiable parameter in this kinetic model, followed by parameter A1.</p>
</section>
</section>
<section id="bootstrap-resampling">
<h2><span class="section-number">5.1.8. </span>Bootstrap resampling<a class="headerlink" href="#bootstrap-resampling" title="Link to this heading">#</a></h2>
<p>Bootstrapping is a resampling method by independently sampling with replacement from an existing sample data with same sample size n, and performing inference among these resampled data (<a class="reference external" href="https://towardsdatascience.com/an-introduction-to-the-bootstrap-method-58bcb51b4d60">link</a>). Bootstrap resampling is often used in parameter estimation problems to determine parameter confidence intervals. More information about bootstrap resampling and confidence interval calculation can be found <a class="reference external" href="https://ocw.mit.edu/courses/mathematics/18-05-introduction-to-probability-and-statistics-spring-2014/readings/MIT18_05S14_Reading24.pdf">here</a>.</p>
<p><code class="docutils literal notranslate"><span class="pre">theta_est_bootstrap()</span></code> is used to perform resampling with <code class="docutils literal notranslate"><span class="pre">parmest</span></code>.  More information can be found <a class="reference external" href="https://pyomo.readthedocs.io/en/stable/contributed_packages/parmest/api.html#pyomo.contrib.parmest.parmest.Estimator.theta_est_bootstrap">here</a>.</p>
<p><code class="docutils literal notranslate"><span class="pre">parmest</span></code> also provides functions to plot bootstrap parameter estimates along with various confidence intervals <a class="reference external" href="https://pyomo.readthedocs.io/en/stable/contributed_packages/parmest/api.html#pyomo.contrib.parmest.graphics.pairwise_plot">link</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># create Estimator object</span>

<span class="n">pest</span> <span class="o">=</span> <span class="n">parmest</span><span class="o">.</span><span class="n">Estimator</span><span class="p">(</span><span class="n">exp_list</span><span class="p">,</span> <span class="n">obj_function</span><span class="o">=</span><span class="s1">&#39;SSE&#39;</span><span class="p">,</span> <span class="n">tee</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

<span class="c1">### Parameter estimation with bootstrap resampling</span>

<span class="n">bootstrap_theta</span> <span class="o">=</span> <span class="n">pest</span><span class="o">.</span><span class="n">theta_est_bootstrap</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">bootstrap_theta</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Ipopt 3.13.2: 

******************************************************************************
This program contains Ipopt, a library for large-scale nonlinear optimization.
 Ipopt is released as open source code under the Eclipse Public License (EPL).
         For more information visit http://projects.coin-or.org/Ipopt

This version of Ipopt was compiled from source code available at
    https://github.com/IDAES/Ipopt as part of the Institute for the Design of
    Advanced Energy Systems Process Systems Engineering Framework (IDAES PSE
    Framework) Copyright (c) 2018-2019. See https://github.com/IDAES/idaes-pse.

This version of Ipopt was compiled using HSL, a collection of Fortran codes
    for large-scale scientific computation.  All technical papers, sales and
    publicity material resulting from use of the HSL codes within IPOPT must
    contain the following acknowledgement:
        HSL, a collection of Fortran codes for large-scale scientific
        computation. See http://www.hsl.rl.ac.uk.
******************************************************************************

This is Ipopt version 3.13.2, running with linear solver ma27.

Number of nonzeros in equality constraint Jacobian...:     1528
Number of nonzeros in inequality constraint Jacobian.:        0
Number of nonzeros in Lagrangian Hessian.............:      544

Total number of variables............................:      448
                     variables with only lower bounds:        0
                variables with lower and upper bounds:       64
                     variables with only upper bounds:        0
Total number of equality constraints.................:      444
Total number of inequality constraints...............:        0
        inequality constraints with only lower bounds:        0
   inequality constraints with lower and upper bounds:        0
        inequality constraints with only upper bounds:        0

iter    objective    inf_pr   inf_du lg(mu)  ||d||  lg(rg) alpha_du alpha_pr  ls
   0  1.2592126e+01 2.00e+00 1.36e-01  -1.0 0.00e+00    -  0.00e+00 0.00e+00   0
   1  2.4281208e-01 3.25e-06 5.33e-04  -1.0 2.00e+00    -  9.91e-01 1.00e+00f  1
   2  2.4273091e-01 1.82e-05 1.48e-06  -1.7 1.98e-02    -  1.00e+00 1.00e+00h  1
   3  2.4270069e-01 4.90e-06 4.61e-07  -3.8 4.66e-01    -  1.00e+00 1.00e+00h  1
   4  2.4226897e-01 3.52e-03 3.05e-05  -5.7 1.88e+01    -  8.66e-01 1.00e+00h  1
   5  2.4219416e-01 6.40e-04 6.27e-06  -5.7 1.68e+01    -  1.00e+00 1.00e+00h  1
   6  2.4218813e-01 3.23e-05 2.82e-07  -5.7 3.66e+00    -  1.00e+00 1.00e+00h  1
   7  2.4218802e-01 6.28e-08 5.47e-10  -5.7 1.60e-01    -  1.00e+00 1.00e+00h  1
   8  2.4218793e-01 1.43e-06 1.47e-08  -8.6 7.64e-01    -  9.96e-01 1.00e+00h  1
   9  2.4218793e-01 1.06e-09 1.04e-11  -8.6 2.07e-02    -  1.00e+00 1.00e+00h  1

Number of Iterations....: 9

                                   (scaled)                 (unscaled)
Objective...............:   2.4218792850427115e-01    2.4218792850427115e-01
Dual infeasibility......:   1.0427097078251914e-11    1.0427097078251914e-11
Constraint violation....:   1.0560190499830924e-09    1.0560190499830924e-09
Complementarity.........:   2.5148073430467801e-09    2.5148073430467801e-09
Overall NLP error.......:   2.5148073430467801e-09    2.5148073430467801e-09


Number of objective function evaluations             = 10
Number of objective gradient evaluations             = 10
Number of equality constraint evaluations            = 10
Number of inequality constraint evaluations          = 0
Number of equality constraint Jacobian evaluations   = 10
Number of inequality constraint Jacobian evaluations = 0
Number of Lagrangian Hessian evaluations             = 9
Total CPU secs in IPOPT (w/o function evaluations)   =      0.005
Total CPU secs in NLP function evaluations           =      0.003

EXIT: Optimal Solution Found.
Ipopt 3.13.2: 

******************************************************************************
This program contains Ipopt, a library for large-scale nonlinear optimization.
 Ipopt is released as open source code under the Eclipse Public License (EPL).
         For more information visit http://projects.coin-or.org/Ipopt

This version of Ipopt was compiled from source code available at
    https://github.com/IDAES/Ipopt as part of the Institute for the Design of
    Advanced Energy Systems Process Systems Engineering Framework (IDAES PSE
    Framework) Copyright (c) 2018-2019. See https://github.com/IDAES/idaes-pse.

This version of Ipopt was compiled using HSL, a collection of Fortran codes
    for large-scale scientific computation.  All technical papers, sales and
    publicity material resulting from use of the HSL codes within IPOPT must
    contain the following acknowledgement:
        HSL, a collection of Fortran codes for large-scale scientific
        computation. See http://www.hsl.rl.ac.uk.
******************************************************************************

This is Ipopt version 3.13.2, running with linear solver ma27.

Number of nonzeros in equality constraint Jacobian...:     1528
Number of nonzeros in inequality constraint Jacobian.:        0
Number of nonzeros in Lagrangian Hessian.............:      544

Total number of variables............................:      448
                     variables with only lower bounds:        0
                variables with lower and upper bounds:       64
                     variables with only upper bounds:        0
Total number of equality constraints.................:      444
Total number of inequality constraints...............:        0
        inequality constraints with only lower bounds:        0
   inequality constraints with lower and upper bounds:        0
        inequality constraints with only upper bounds:        0

iter    objective    inf_pr   inf_du lg(mu)  ||d||  lg(rg) alpha_du alpha_pr  ls
   0  1.1130021e+01 2.00e+00 1.29e-01  -1.0 0.00e+00    -  0.00e+00 0.00e+00   0
   1  2.1450418e-01 2.48e-06 7.94e-04  -1.0 2.00e+00    -  9.91e-01 1.00e+00f  1
   2  2.1329569e-01 2.41e-04 4.14e-05  -1.7 9.15e-02    -  1.00e+00 1.00e+00h  1
   3  2.1309689e-01 3.25e-05 4.15e-06  -3.8 1.24e+00    -  9.95e-01 1.00e+00h  1
   4  2.1004486e-01 3.13e-02 2.89e-04  -5.7 5.25e+01    -  8.27e-01 1.00e+00h  1
   5  2.0935359e-01 5.58e-03 5.37e-05  -5.7 4.70e+01    -  1.00e+00 1.00e+00h  1
   6  2.0919143e-01 5.35e-04 6.67e-06  -5.7 1.30e+01    -  1.00e+00 1.00e+00h  1
   7  2.0916259e-01 1.39e-04 7.48e-07  -5.7 6.43e+00    -  1.00e+00 1.00e+00h  1
   8  2.0915651e-01 1.10e-05 5.93e-08  -5.7 1.78e+00    -  1.00e+00 1.00e+00h  1
   9  2.0914468e-01 8.54e-05 4.88e-07  -8.6 4.91e+00    -  9.76e-01 1.00e+00h  1
iter    objective    inf_pr   inf_du lg(mu)  ||d||  lg(rg) alpha_du alpha_pr  ls
  10  2.0914141e-01 2.14e-05 1.18e-07  -8.6 2.43e+00    -  1.00e+00 1.00e+00h  1
  11  2.0914047e-01 5.24e-06 2.91e-08  -8.6 1.19e+00    -  1.00e+00 1.00e+00h  1
  12  2.0914020e-01 9.84e-07 5.48e-09  -8.6 5.15e-01    -  1.00e+00 1.00e+00h  1
  13  2.0914014e-01 8.78e-08 4.90e-10  -8.6 1.54e-01    -  1.00e+00 1.00e+00h  1
  14  2.0914013e-01 1.03e-09 5.75e-12  -8.6 1.66e-02    -  1.00e+00 1.00e+00h  1

Number of Iterations....: 14

                                   (scaled)                 (unscaled)
Objective...............:   2.0914012909343274e-01    2.0914012909343274e-01
Dual infeasibility......:   5.7510498247306951e-12    5.7510498247306951e-12
Constraint violation....:   1.0297200869757717e-09    1.0297200869757717e-09
Complementarity.........:   2.5112796767814955e-09    2.5112796767814955e-09
Overall NLP error.......:   2.5112796767814955e-09    2.5112796767814955e-09


Number of objective function evaluations             = 15
Number of objective gradient evaluations             = 15
Number of equality constraint evaluations            = 15
Number of inequality constraint evaluations          = 0
Number of equality constraint Jacobian evaluations   = 15
Number of inequality constraint Jacobian evaluations = 0
Number of Lagrangian Hessian evaluations             = 14
Total CPU secs in IPOPT (w/o function evaluations)   =      0.008
Total CPU secs in NLP function evaluations           =      0.002

EXIT: Optimal Solution Found.
Ipopt 3.13.2: 

******************************************************************************
This program contains Ipopt, a library for large-scale nonlinear optimization.
 Ipopt is released as open source code under the Eclipse Public License (EPL).
         For more information visit http://projects.coin-or.org/Ipopt

This version of Ipopt was compiled from source code available at
    https://github.com/IDAES/Ipopt as part of the Institute for the Design of
    Advanced Energy Systems Process Systems Engineering Framework (IDAES PSE
    Framework) Copyright (c) 2018-2019. See https://github.com/IDAES/idaes-pse.

This version of Ipopt was compiled using HSL, a collection of Fortran codes
    for large-scale scientific computation.  All technical papers, sales and
    publicity material resulting from use of the HSL codes within IPOPT must
    contain the following acknowledgement:
        HSL, a collection of Fortran codes for large-scale scientific
        computation. See http://www.hsl.rl.ac.uk.
******************************************************************************

This is Ipopt version 3.13.2, running with linear solver ma27.

Number of nonzeros in equality constraint Jacobian...:     1528
Number of nonzeros in inequality constraint Jacobian.:        0
Number of nonzeros in Lagrangian Hessian.............:      544

Total number of variables............................:      448
                     variables with only lower bounds:        0
                variables with lower and upper bounds:       64
                     variables with only upper bounds:        0
Total number of equality constraints.................:      444
Total number of inequality constraints...............:        0
        inequality constraints with only lower bounds:        0
   inequality constraints with lower and upper bounds:        0
        inequality constraints with only upper bounds:        0

iter    objective    inf_pr   inf_du lg(mu)  ||d||  lg(rg) alpha_du alpha_pr  ls
   0  1.5701740e+01 2.00e+00 1.30e-01  -1.0 0.00e+00    -  0.00e+00 0.00e+00   0
   1  2.4396072e-01 6.04e-06 7.08e-04  -1.0 2.00e+00    -  9.91e-01 1.00e+00f  1
   2  2.4147315e-01 3.07e-04 1.12e-04  -1.7 9.89e-02    -  1.00e+00 1.00e+00h  1
   3  2.4141069e-01 8.59e-06 2.44e-06  -3.8 4.44e-01    -  1.00e+00 1.00e+00h  1
   4  2.4012797e-01 3.74e-03 3.57e-05  -5.7 3.93e+01    -  7.34e-01 1.00e+00h  1
   5  2.3949135e-01 2.29e-03 1.71e-05  -5.7 3.68e+01    -  1.00e+00 1.00e+00h  1
   6  2.3927705e-01 4.63e-04 3.44e-06  -5.7 1.78e+01    -  1.00e+00 1.00e+00h  1
   7  2.3924687e-01 1.19e-05 8.80e-08  -5.7 2.93e+00    -  1.00e+00 1.00e+00h  1
   8  2.3921871e-01 8.80e-06 6.61e-08  -8.6 2.53e+00    -  9.89e-01 1.00e+00h  1
   9  2.3921756e-01 1.69e-08 1.27e-10  -8.6 1.12e-01    -  1.00e+00 1.00e+00h  1
iter    objective    inf_pr   inf_du lg(mu)  ||d||  lg(rg) alpha_du alpha_pr  ls
  10  2.3921753e-01 8.47e-12 6.36e-14  -9.0 2.50e-03    -  1.00e+00 1.00e+00h  1

Number of Iterations....: 10

                                   (scaled)                 (unscaled)
Objective...............:   2.3921753224215234e-01    2.3921753224215234e-01
Dual infeasibility......:   6.3623990926121881e-14    6.3623990926121881e-14
Constraint violation....:   8.4734441685441197e-12    8.4734441685441197e-12
Complementarity.........:   9.0916085845819665e-10    9.0916085845819665e-10
Overall NLP error.......:   9.0916085845819665e-10    9.0916085845819665e-10


Number of objective function evaluations             = 11
Number of objective gradient evaluations             = 11
Number of equality constraint evaluations            = 11
Number of inequality constraint evaluations          = 0
Number of equality constraint Jacobian evaluations   = 11
Number of inequality constraint Jacobian evaluations = 0
Number of Lagrangian Hessian evaluations             = 10
Total CPU secs in IPOPT (w/o function evaluations)   =      0.008
Total CPU secs in NLP function evaluations           =      0.001

EXIT: Optimal Solution Found.
Ipopt 3.13.2: 

******************************************************************************
This program contains Ipopt, a library for large-scale nonlinear optimization.
 Ipopt is released as open source code under the Eclipse Public License (EPL).
         For more information visit http://projects.coin-or.org/Ipopt

This version of Ipopt was compiled from source code available at
    https://github.com/IDAES/Ipopt as part of the Institute for the Design of
    Advanced Energy Systems Process Systems Engineering Framework (IDAES PSE
    Framework) Copyright (c) 2018-2019. See https://github.com/IDAES/idaes-pse.

This version of Ipopt was compiled using HSL, a collection of Fortran codes
    for large-scale scientific computation.  All technical papers, sales and
    publicity material resulting from use of the HSL codes within IPOPT must
    contain the following acknowledgement:
        HSL, a collection of Fortran codes for large-scale scientific
        computation. See http://www.hsl.rl.ac.uk.
******************************************************************************

This is Ipopt version 3.13.2, running with linear solver ma27.

Number of nonzeros in equality constraint Jacobian...:     1528
Number of nonzeros in inequality constraint Jacobian.:        0
Number of nonzeros in Lagrangian Hessian.............:      544

Total number of variables............................:      448
                     variables with only lower bounds:        0
                variables with lower and upper bounds:       64
                     variables with only upper bounds:        0
Total number of equality constraints.................:      444
Total number of inequality constraints...............:        0
        inequality constraints with only lower bounds:        0
   inequality constraints with lower and upper bounds:        0
        inequality constraints with only upper bounds:        0

iter    objective    inf_pr   inf_du lg(mu)  ||d||  lg(rg) alpha_du alpha_pr  ls
   0  1.2439722e+01 1.95e+00 1.21e-01  -1.0 0.00e+00    -  0.00e+00 0.00e+00   0
   1  2.2305711e-01 8.15e-06 1.93e-03  -1.0 1.95e+00    -  9.91e-01 1.00e+00f  1
   2  2.2209585e-01 1.99e-04 4.28e-05  -1.7 6.31e-02    -  1.00e+00 1.00e+00h  1
   3  2.2199626e-01 1.01e-05 7.07e-07  -3.8 1.04e+00    -  9.97e-01 1.00e+00h  1
   4  2.2006688e-01 2.12e-02 1.82e-04  -5.7 4.40e+01    -  8.98e-01 1.00e+00h  1
   5  2.1986930e-01 1.18e-03 1.85e-05  -5.7 2.42e+01    -  1.00e+00 1.00e+00h  1
   6  2.1984720e-01 7.16e-05 6.50e-07  -5.7 5.39e+00    -  1.00e+00 1.00e+00h  1
   7  2.1984699e-01 9.24e-07 6.07e-09  -5.7 6.03e-01    -  1.00e+00 1.00e+00h  1
   8  2.1984679e-01 3.08e-06 1.58e-08  -8.6 1.10e+00    -  9.94e-01 1.00e+00h  1
   9  2.1984679e-01 3.92e-09 2.35e-11  -8.6 3.91e-02    -  1.00e+00 1.00e+00h  1

Number of Iterations....: 9

                                   (scaled)                 (unscaled)
Objective...............:   2.1984678947461242e-01    2.1984678947461242e-01
Dual infeasibility......:   2.3529802826964871e-11    2.3529802826964871e-11
Constraint violation....:   3.9191224709966832e-09    3.9191224709966832e-09
Complementarity.........:   2.5381135858585810e-09    2.5381135858585810e-09
Overall NLP error.......:   3.9191224709966832e-09    3.9191224709966832e-09


Number of objective function evaluations             = 10
Number of objective gradient evaluations             = 10
Number of equality constraint evaluations            = 10
Number of inequality constraint evaluations          = 0
Number of equality constraint Jacobian evaluations   = 10
Number of inequality constraint Jacobian evaluations = 0
Number of Lagrangian Hessian evaluations             = 9
Total CPU secs in IPOPT (w/o function evaluations)   =      0.005
Total CPU secs in NLP function evaluations           =      0.004

EXIT: Optimal Solution Found.
Ipopt 3.13.2: 

******************************************************************************
This program contains Ipopt, a library for large-scale nonlinear optimization.
 Ipopt is released as open source code under the Eclipse Public License (EPL).
         For more information visit http://projects.coin-or.org/Ipopt

This version of Ipopt was compiled from source code available at
    https://github.com/IDAES/Ipopt as part of the Institute for the Design of
    Advanced Energy Systems Process Systems Engineering Framework (IDAES PSE
    Framework) Copyright (c) 2018-2019. See https://github.com/IDAES/idaes-pse.

This version of Ipopt was compiled using HSL, a collection of Fortran codes
    for large-scale scientific computation.  All technical papers, sales and
    publicity material resulting from use of the HSL codes within IPOPT must
    contain the following acknowledgement:
        HSL, a collection of Fortran codes for large-scale scientific
        computation. See http://www.hsl.rl.ac.uk.
******************************************************************************

This is Ipopt version 3.13.2, running with linear solver ma27.

Number of nonzeros in equality constraint Jacobian...:     1528
Number of nonzeros in inequality constraint Jacobian.:        0
Number of nonzeros in Lagrangian Hessian.............:      544

Total number of variables............................:      448
                     variables with only lower bounds:        0
                variables with lower and upper bounds:       64
                     variables with only upper bounds:        0
Total number of equality constraints.................:      444
Total number of inequality constraints...............:        0
        inequality constraints with only lower bounds:        0
   inequality constraints with lower and upper bounds:        0
        inequality constraints with only upper bounds:        0

iter    objective    inf_pr   inf_du lg(mu)  ||d||  lg(rg) alpha_du alpha_pr  ls
   0  2.1842207e+01 2.00e+00 1.67e-01  -1.0 0.00e+00    -  0.00e+00 0.00e+00   0
   1  2.2084391e-01 8.29e-06 9.38e-04  -1.0 2.00e+00    -  9.91e-01 1.00e+00f  1
   2  2.1772329e-01 3.39e-04 8.99e-05  -1.7 1.09e-01    -  1.00e+00 1.00e+00h  1
   3  2.1765730e-01 5.37e-06 1.80e-06  -3.8 1.62e-01    -  1.00e+00 1.00e+00h  1
   4  2.1761599e-01 1.74e-04 1.52e-06  -5.7 4.79e+00    -  9.67e-01 1.00e+00h  1
   5  2.1760509e-01 1.15e-04 8.26e-07  -5.7 7.44e+00    -  1.00e+00 1.00e+00h  1
   6  2.1760479e-01 9.97e-07 6.70e-09  -5.7 7.07e-01    -  1.00e+00 1.00e+00h  1
   7  2.1760478e-01 1.60e-07 1.13e-09  -8.6 2.83e-01    -  9.99e-01 1.00e+00h  1
   8  2.1760478e-01 8.87e-11 6.14e-13  -8.6 6.69e-03    -  1.00e+00 1.00e+00h  1

Number of Iterations....: 8

                                   (scaled)                 (unscaled)
Objective...............:   2.1760477732920155e-01    2.1760477732920155e-01
Dual infeasibility......:   6.1432087617157113e-13    6.1432087617157113e-13
Constraint violation....:   8.8729690261857286e-11    8.8729690261857286e-11
Complementarity.........:   2.5065269692916554e-09    2.5065269692916554e-09
Overall NLP error.......:   2.5065269692916554e-09    2.5065269692916554e-09


Number of objective function evaluations             = 9
Number of objective gradient evaluations             = 9
Number of equality constraint evaluations            = 9
Number of inequality constraint evaluations          = 0
Number of equality constraint Jacobian evaluations   = 9
Number of inequality constraint Jacobian evaluations = 0
Number of Lagrangian Hessian evaluations             = 8
Total CPU secs in IPOPT (w/o function evaluations)   =      0.006
Total CPU secs in NLP function evaluations           =      0.002

EXIT: Optimal Solution Found.
Ipopt 3.13.2: 

******************************************************************************
This program contains Ipopt, a library for large-scale nonlinear optimization.
 Ipopt is released as open source code under the Eclipse Public License (EPL).
         For more information visit http://projects.coin-or.org/Ipopt

This version of Ipopt was compiled from source code available at
    https://github.com/IDAES/Ipopt as part of the Institute for the Design of
    Advanced Energy Systems Process Systems Engineering Framework (IDAES PSE
    Framework) Copyright (c) 2018-2019. See https://github.com/IDAES/idaes-pse.

This version of Ipopt was compiled using HSL, a collection of Fortran codes
    for large-scale scientific computation.  All technical papers, sales and
    publicity material resulting from use of the HSL codes within IPOPT must
    contain the following acknowledgement:
        HSL, a collection of Fortran codes for large-scale scientific
        computation. See http://www.hsl.rl.ac.uk.
******************************************************************************

This is Ipopt version 3.13.2, running with linear solver ma27.

Number of nonzeros in equality constraint Jacobian...:     1528
Number of nonzeros in inequality constraint Jacobian.:        0
Number of nonzeros in Lagrangian Hessian.............:      544

Total number of variables............................:      448
                     variables with only lower bounds:        0
                variables with lower and upper bounds:       64
                     variables with only upper bounds:        0
Total number of equality constraints.................:      444
Total number of inequality constraints...............:        0
        inequality constraints with only lower bounds:        0
   inequality constraints with lower and upper bounds:        0
        inequality constraints with only upper bounds:        0

iter    objective    inf_pr   inf_du lg(mu)  ||d||  lg(rg) alpha_du alpha_pr  ls
   0  1.5082369e+01 2.00e+00 1.32e-01  -1.0 0.00e+00    -  0.00e+00 0.00e+00   0
   1  2.1512438e-01 8.80e-06 1.05e-03  -1.0 2.00e+00    -  9.91e-01 1.00e+00f  1
   2  2.1443321e-01 1.64e-04 1.16e-05  -1.7 4.68e-02    -  1.00e+00 1.00e+00h  1
   3  2.1428685e-01 1.58e-05 2.61e-07  -3.8 1.31e+00    -  9.94e-01 1.00e+00h  1
   4  2.1189138e-01 1.62e-02 1.35e-04  -5.7 3.86e+01    -  8.32e-01 1.00e+00h  1
   5  2.1146420e-01 2.83e-03 3.20e-05  -5.7 3.42e+01    -  1.00e+00 1.00e+00h  1
   6  2.1138745e-01 3.51e-04 3.98e-06  -5.7 1.11e+01    -  1.00e+00 1.00e+00h  1
   7  2.1138066e-01 3.81e-05 4.32e-07  -5.7 3.57e+00    -  1.00e+00 1.00e+00h  1
   8  2.1138025e-01 4.77e-07 5.41e-09  -5.7 3.97e-01    -  1.00e+00 1.00e+00h  1
   9  2.1137939e-01 1.12e-05 1.34e-07  -8.6 1.92e+00    -  9.90e-01 1.00e+00h  1
iter    objective    inf_pr   inf_du lg(mu)  ||d||  lg(rg) alpha_du alpha_pr  ls
  10  2.1137937e-01 6.95e-08 8.04e-10  -8.6 1.50e-01    -  1.00e+00 1.00e+00h  1
  11  2.1137937e-01 2.59e-12 3.00e-14  -8.6 9.17e-04    -  1.00e+00 1.00e+00h  1

Number of Iterations....: 11

                                   (scaled)                 (unscaled)
Objective...............:   2.1137936724570658e-01    2.1137936724570658e-01
Dual infeasibility......:   2.9971892143540737e-14    2.9971892143540737e-14
Constraint violation....:   2.5907054279628028e-12    2.5907054279628028e-12
Complementarity.........:   2.5059279484415384e-09    2.5059279484415384e-09
Overall NLP error.......:   2.5059279484415384e-09    2.5059279484415384e-09


Number of objective function evaluations             = 12
Number of objective gradient evaluations             = 12
Number of equality constraint evaluations            = 12
Number of inequality constraint evaluations          = 0
Number of equality constraint Jacobian evaluations   = 12
Number of inequality constraint Jacobian evaluations = 0
Number of Lagrangian Hessian evaluations             = 11
Total CPU secs in IPOPT (w/o function evaluations)   =      0.007
Total CPU secs in NLP function evaluations           =      0.001

EXIT: Optimal Solution Found.
Ipopt 3.13.2: 

******************************************************************************
This program contains Ipopt, a library for large-scale nonlinear optimization.
 Ipopt is released as open source code under the Eclipse Public License (EPL).
         For more information visit http://projects.coin-or.org/Ipopt

This version of Ipopt was compiled from source code available at
    https://github.com/IDAES/Ipopt as part of the Institute for the Design of
    Advanced Energy Systems Process Systems Engineering Framework (IDAES PSE
    Framework) Copyright (c) 2018-2019. See https://github.com/IDAES/idaes-pse.

This version of Ipopt was compiled using HSL, a collection of Fortran codes
    for large-scale scientific computation.  All technical papers, sales and
    publicity material resulting from use of the HSL codes within IPOPT must
    contain the following acknowledgement:
        HSL, a collection of Fortran codes for large-scale scientific
        computation. See http://www.hsl.rl.ac.uk.
******************************************************************************

This is Ipopt version 3.13.2, running with linear solver ma27.

Number of nonzeros in equality constraint Jacobian...:     1528
Number of nonzeros in inequality constraint Jacobian.:        0
Number of nonzeros in Lagrangian Hessian.............:      544

Total number of variables............................:      448
                     variables with only lower bounds:        0
                variables with lower and upper bounds:       64
                     variables with only upper bounds:        0
Total number of equality constraints.................:      444
Total number of inequality constraints...............:        0
        inequality constraints with only lower bounds:        0
   inequality constraints with lower and upper bounds:        0
        inequality constraints with only upper bounds:        0

iter    objective    inf_pr   inf_du lg(mu)  ||d||  lg(rg) alpha_du alpha_pr  ls
   0  1.3935145e+01 2.00e+00 1.30e-01  -1.0 0.00e+00    -  0.00e+00 0.00e+00   0
   1  2.4203118e-01 8.64e-06 9.78e-04  -1.0 2.00e+00    -  9.91e-01 1.00e+00f  1
   2  2.3739268e-01 6.74e-04 1.30e-04  -1.7 1.53e-01    -  1.00e+00 1.00e+00h  1
   3  2.3728281e-01 1.99e-05 3.14e-06  -3.8 7.61e-01    -  1.00e+00 1.00e+00h  1
   4  2.3601478e-01 3.93e-03 3.39e-05  -5.7 2.89e+01    -  7.91e-01 1.00e+00h  1
   5  2.3553513e-01 2.15e-03 2.16e-05  -5.7 3.39e+01    -  1.00e+00 1.00e+00h  1
   6  2.3538642e-01 6.89e-04 6.27e-06  -5.7 2.11e+01    -  1.00e+00 1.00e+00h  1
   7  2.3534837e-01 9.01e-05 8.07e-07  -5.7 7.94e+00    -  1.00e+00 1.00e+00h  1
   8  2.3534321e-01 2.05e-06 1.85e-08  -5.7 1.21e+00    -  1.00e+00 1.00e+00h  1
   9  2.3532146e-01 3.88e-05 3.65e-07  -8.6 5.31e+00    -  9.75e-01 1.00e+00h  1
iter    objective    inf_pr   inf_du lg(mu)  ||d||  lg(rg) alpha_du alpha_pr  ls
  10  2.3531737e-01 1.75e-06 1.61e-08  -8.6 1.13e+00    -  1.00e+00 1.00e+00h  1
  11  2.3531722e-01 2.68e-09 2.47e-11  -8.6 4.45e-02    -  1.00e+00 1.00e+00h  1

Number of Iterations....: 11

                                   (scaled)                 (unscaled)
Objective...............:   2.3531721677772968e-01    2.3531721677772968e-01
Dual infeasibility......:   2.4664363499299724e-11    2.4664363499299724e-11
Constraint violation....:   2.6836806110708267e-09    2.6836806110708267e-09
Complementarity.........:   2.5193272931833644e-09    2.5193272931833644e-09
Overall NLP error.......:   2.6836806110708267e-09    2.6836806110708267e-09


Number of objective function evaluations             = 12
Number of objective gradient evaluations             = 12
Number of equality constraint evaluations            = 12
Number of inequality constraint evaluations          = 0
Number of equality constraint Jacobian evaluations   = 12
Number of inequality constraint Jacobian evaluations = 0
Number of Lagrangian Hessian evaluations             = 11
Total CPU secs in IPOPT (w/o function evaluations)   =      0.005
Total CPU secs in NLP function evaluations           =      0.002

EXIT: Optimal Solution Found.
Ipopt 3.13.2: 

******************************************************************************
This program contains Ipopt, a library for large-scale nonlinear optimization.
 Ipopt is released as open source code under the Eclipse Public License (EPL).
         For more information visit http://projects.coin-or.org/Ipopt

This version of Ipopt was compiled from source code available at
    https://github.com/IDAES/Ipopt as part of the Institute for the Design of
    Advanced Energy Systems Process Systems Engineering Framework (IDAES PSE
    Framework) Copyright (c) 2018-2019. See https://github.com/IDAES/idaes-pse.

This version of Ipopt was compiled using HSL, a collection of Fortran codes
    for large-scale scientific computation.  All technical papers, sales and
    publicity material resulting from use of the HSL codes within IPOPT must
    contain the following acknowledgement:
        HSL, a collection of Fortran codes for large-scale scientific
        computation. See http://www.hsl.rl.ac.uk.
******************************************************************************

This is Ipopt version 3.13.2, running with linear solver ma27.

Number of nonzeros in equality constraint Jacobian...:     1528
Number of nonzeros in inequality constraint Jacobian.:        0
Number of nonzeros in Lagrangian Hessian.............:      544

Total number of variables............................:      448
                     variables with only lower bounds:        0
                variables with lower and upper bounds:       64
                     variables with only upper bounds:        0
Total number of equality constraints.................:      444
Total number of inequality constraints...............:        0
        inequality constraints with only lower bounds:        0
   inequality constraints with lower and upper bounds:        0
        inequality constraints with only upper bounds:        0

iter    objective    inf_pr   inf_du lg(mu)  ||d||  lg(rg) alpha_du alpha_pr  ls
   0  1.6333230e+01 1.95e+00 1.54e-01  -1.0 0.00e+00    -  0.00e+00 0.00e+00   0
   1  2.4590917e-01 8.68e-06 7.89e-04  -1.0 1.95e+00    -  9.91e-01 1.00e+00f  1
   2  2.4103269e-01 5.06e-04 2.00e-04  -1.7 1.52e-01    -  1.00e+00 1.00e+00h  1
   3  2.4101218e-01 1.17e-05 4.85e-06  -3.8 1.74e-01    -  1.00e+00 1.00e+00h  1
   4  2.4092607e-01 2.42e-04 2.78e-06  -5.7 9.44e+00    -  9.26e-01 1.00e+00h  1
   5  2.4088107e-01 6.18e-04 4.54e-06  -5.7 1.66e+01    -  1.00e+00 1.00e+00h  1
   6  2.4088053e-01 7.26e-06 8.37e-08  -5.7 1.76e+00    -  1.00e+00 1.00e+00h  1
   7  2.4088049e-01 1.38e-06 1.01e-08  -8.6 7.58e-01    -  9.95e-01 1.00e+00h  1
   8  2.4088049e-01 1.04e-09 7.68e-12  -8.6 2.08e-02    -  1.00e+00 1.00e+00h  1

Number of Iterations....: 8

                                   (scaled)                 (unscaled)
Objective...............:   2.4088049315145352e-01    2.4088049315145352e-01
Dual infeasibility......:   7.6810857901397675e-12    7.6810857901397675e-12
Constraint violation....:   1.0401730587972224e-09    1.0401730587972224e-09
Complementarity.........:   2.5142603482557913e-09    2.5142603482557913e-09
Overall NLP error.......:   2.5142603482557913e-09    2.5142603482557913e-09


Number of objective function evaluations             = 9
Number of objective gradient evaluations             = 9
Number of equality constraint evaluations            = 9
Number of inequality constraint evaluations          = 0
Number of equality constraint Jacobian evaluations   = 9
Number of inequality constraint Jacobian evaluations = 0
Number of Lagrangian Hessian evaluations             = 8
Total CPU secs in IPOPT (w/o function evaluations)   =      0.005
Total CPU secs in NLP function evaluations           =      0.002

EXIT: Optimal Solution Found.
Ipopt 3.13.2: 

******************************************************************************
This program contains Ipopt, a library for large-scale nonlinear optimization.
 Ipopt is released as open source code under the Eclipse Public License (EPL).
         For more information visit http://projects.coin-or.org/Ipopt

This version of Ipopt was compiled from source code available at
    https://github.com/IDAES/Ipopt as part of the Institute for the Design of
    Advanced Energy Systems Process Systems Engineering Framework (IDAES PSE
    Framework) Copyright (c) 2018-2019. See https://github.com/IDAES/idaes-pse.

This version of Ipopt was compiled using HSL, a collection of Fortran codes
    for large-scale scientific computation.  All technical papers, sales and
    publicity material resulting from use of the HSL codes within IPOPT must
    contain the following acknowledgement:
        HSL, a collection of Fortran codes for large-scale scientific
        computation. See http://www.hsl.rl.ac.uk.
******************************************************************************

This is Ipopt version 3.13.2, running with linear solver ma27.

Number of nonzeros in equality constraint Jacobian...:     1528
Number of nonzeros in inequality constraint Jacobian.:        0
Number of nonzeros in Lagrangian Hessian.............:      544

Total number of variables............................:      448
                     variables with only lower bounds:        0
                variables with lower and upper bounds:       64
                     variables with only upper bounds:        0
Total number of equality constraints.................:      444
Total number of inequality constraints...............:        0
        inequality constraints with only lower bounds:        0
   inequality constraints with lower and upper bounds:        0
        inequality constraints with only upper bounds:        0

iter    objective    inf_pr   inf_du lg(mu)  ||d||  lg(rg) alpha_du alpha_pr  ls
   0  1.6415199e+01 2.00e+00 1.43e-01  -1.0 0.00e+00    -  0.00e+00 0.00e+00   0
   1  2.3519676e-01 1.75e-05 5.83e-04  -1.0 2.00e+00    -  9.91e-01 1.00e+00f  1
   2  2.3027811e-01 5.59e-04 1.84e-04  -1.7 1.36e-01    -  1.00e+00 1.00e+00h  1
   3  2.3025823e-01 6.82e-06 2.45e-06  -3.8 4.38e-01    -  1.00e+00 1.00e+00h  1
   4  2.2919775e-01 3.31e-03 2.87e-05  -5.7 4.04e+01    -  7.28e-01 1.00e+00h  1
   5  2.2850890e-01 2.52e-03 2.09e-05  -5.7 3.91e+01    -  1.00e+00 1.00e+00h  1
   6  2.2829639e-01 3.82e-04 3.08e-06  -5.7 1.63e+01    -  1.00e+00 1.00e+00h  1
   7  2.2827869e-01 3.50e-06 2.70e-08  -5.7 1.59e+00    -  1.00e+00 1.00e+00h  1
   8  2.2825045e-01 6.13e-06 5.39e-08  -8.6 2.13e+00    -  9.91e-01 1.00e+00h  1
   9  2.2824970e-01 5.07e-09 4.22e-11  -8.6 6.12e-02    -  1.00e+00 1.00e+00h  1

Number of Iterations....: 9

                                   (scaled)                 (unscaled)
Objective...............:   2.2824970226527747e-01    2.2824970226527747e-01
Dual infeasibility......:   4.2170372619787979e-11    4.2170372619787979e-11
Constraint violation....:   5.0666827400291936e-09    5.0666827400291936e-09
Complementarity.........:   2.5326953143394347e-09    2.5326953143394347e-09
Overall NLP error.......:   5.0666827400291936e-09    5.0666827400291936e-09


Number of objective function evaluations             = 10
Number of objective gradient evaluations             = 10
Number of equality constraint evaluations            = 10
Number of inequality constraint evaluations          = 0
Number of equality constraint Jacobian evaluations   = 10
Number of inequality constraint Jacobian evaluations = 0
Number of Lagrangian Hessian evaluations             = 9
Total CPU secs in IPOPT (w/o function evaluations)   =      0.006
Total CPU secs in NLP function evaluations           =      0.001

EXIT: Optimal Solution Found.
Ipopt 3.13.2: 

******************************************************************************
This program contains Ipopt, a library for large-scale nonlinear optimization.
 Ipopt is released as open source code under the Eclipse Public License (EPL).
         For more information visit http://projects.coin-or.org/Ipopt

This version of Ipopt was compiled from source code available at
    https://github.com/IDAES/Ipopt as part of the Institute for the Design of
    Advanced Energy Systems Process Systems Engineering Framework (IDAES PSE
    Framework) Copyright (c) 2018-2019. See https://github.com/IDAES/idaes-pse.

This version of Ipopt was compiled using HSL, a collection of Fortran codes
    for large-scale scientific computation.  All technical papers, sales and
    publicity material resulting from use of the HSL codes within IPOPT must
    contain the following acknowledgement:
        HSL, a collection of Fortran codes for large-scale scientific
        computation. See http://www.hsl.rl.ac.uk.
******************************************************************************

This is Ipopt version 3.13.2, running with linear solver ma27.

Number of nonzeros in equality constraint Jacobian...:     1528
Number of nonzeros in inequality constraint Jacobian.:        0
Number of nonzeros in Lagrangian Hessian.............:      544

Total number of variables............................:      448
                     variables with only lower bounds:        0
                variables with lower and upper bounds:       64
                     variables with only upper bounds:        0
Total number of equality constraints.................:      444
Total number of inequality constraints...............:        0
        inequality constraints with only lower bounds:        0
   inequality constraints with lower and upper bounds:        0
        inequality constraints with only upper bounds:        0

iter    objective    inf_pr   inf_du lg(mu)  ||d||  lg(rg) alpha_du alpha_pr  ls
   0  2.5739535e+01 2.00e+00 1.79e-01  -1.0 0.00e+00    -  0.00e+00 0.00e+00   0
   1  2.0661280e-01 2.50e-05 1.38e-03  -1.0 2.00e+00    -  9.91e-01 1.00e+00f  1
   2  2.0073777e-01 4.50e-04 9.34e-05  -1.7 1.25e-01    -  1.00e+00 1.00e+00h  1
   3  2.0065697e-01 3.77e-06 7.82e-07  -3.8 3.66e-01    -  1.00e+00 1.00e+00h  1
   4  1.9996926e-01 2.02e-03 1.75e-05  -5.7 3.02e+01    -  7.83e-01 1.00e+00h  1
   5  1.9958166e-01 1.84e-03 1.38e-05  -5.7 3.22e+01    -  1.00e+00 1.00e+00h  1
   6  1.9945710e-01 5.72e-04 4.31e-06  -5.7 1.93e+01    -  1.00e+00 1.00e+00h  1
   7  1.9942351e-01 8.85e-05 6.69e-07  -5.7 7.84e+00    -  1.00e+00 1.00e+00h  1
   8  1.9941745e-01 4.15e-06 3.14e-08  -5.7 1.72e+00    -  1.00e+00 1.00e+00h  1
   9  1.9940051e-01 4.66e-05 3.57e-07  -8.6 5.79e+00    -  9.72e-01 1.00e+00h  1
iter    objective    inf_pr   inf_du lg(mu)  ||d||  lg(rg) alpha_du alpha_pr  ls
  10  1.9939542e-01 6.90e-06 5.23e-08  -8.6 2.25e+00    -  1.00e+00 1.00e+00h  1
  11  1.9939462e-01 2.00e-07 1.52e-09  -8.6 3.85e-01    -  1.00e+00 1.00e+00h  1
  12  1.9939460e-01 1.62e-10 1.23e-12  -8.6 1.10e-02    -  1.00e+00 1.00e+00h  1

Number of Iterations....: 12

                                   (scaled)                 (unscaled)
Objective...............:   1.9939459765620607e-01    1.9939459765620607e-01
Dual infeasibility......:   1.2301984165340900e-12    1.2301984165340900e-12
Constraint violation....:   1.6208756559166204e-10    1.6208756559166204e-10
Complementarity.........:   2.5070327221401204e-09    2.5070327221401204e-09
Overall NLP error.......:   2.5070327221401204e-09    2.5070327221401204e-09


Number of objective function evaluations             = 13
Number of objective gradient evaluations             = 13
Number of equality constraint evaluations            = 13
Number of inequality constraint evaluations          = 0
Number of equality constraint Jacobian evaluations   = 13
Number of inequality constraint Jacobian evaluations = 0
Number of Lagrangian Hessian evaluations             = 12
Total CPU secs in IPOPT (w/o function evaluations)   =      0.007
Total CPU secs in NLP function evaluations           =      0.001

EXIT: Optimal Solution Found.
          E2        E1          A2          A1
0  14.728451  9.777382  366.382668  179.167485
1  14.008765  9.304571  300.100481  145.197585
2  15.477783  9.680324  499.998675  176.293973
3  14.647181  9.450998  355.859651  152.982091
4  14.948308  9.971654  413.297037  194.342527
</pre></div>
</div>
</div>
</div>
<p>Once the parameter estimates are generated through bootstrap resampling, we can visualize the estimates using the <code class="docutils literal notranslate"><span class="pre">pairwise_plot()</span></code> function as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pyomo</span><span class="o">.</span><span class="n">contrib</span><span class="o">.</span><span class="n">parmest</span><span class="o">.</span><span class="n">graphics</span><span class="o">.</span><span class="n">pairwise_plot</span><span class="p">(</span><span class="n">bootstrap_theta</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Bootstrap theta estimates&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/dcd5ca500df7bdfd8a3e88777cfb920b9bd2c52e19bcba1ad2d57f20e8bfd338.png" src="../../_images/dcd5ca500df7bdfd8a3e88777cfb920b9bd2c52e19bcba1ad2d57f20e8bfd338.png" />
</div>
</div>
<p>Confidence regions can be plotted around the bootstrap estimates for various distributions with confidence <span class="math notranslate nohighlight">\(\alpha\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># plot bootstrap parameter estimates with confidence intervals</span>
<span class="n">pyomo</span><span class="o">.</span><span class="n">contrib</span><span class="o">.</span><span class="n">parmest</span><span class="o">.</span><span class="n">graphics</span><span class="o">.</span><span class="n">pairwise_plot</span><span class="p">(</span><span class="n">bootstrap_theta</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;MVN&#39;</span><span class="p">,</span> <span class="s1">&#39;KDE&#39;</span><span class="p">,</span> <span class="s1">&#39;Rect&#39;</span><span class="p">],</span>
                      <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Bootstrap theta with confidence regions&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/ccc8de3bc40df8ba25b2dd6569c2f697e29c47fc55df1d576c1b8c43b525cdbb.png" src="../../_images/ccc8de3bc40df8ba25b2dd6569c2f697e29c47fc55df1d576c1b8c43b525cdbb.png" />
</div>
</div>
</section>
<section id="nonlinear-confidence-regions">
<h2><span class="section-number">5.1.9. </span>Nonlinear confidence regions<a class="headerlink" href="#nonlinear-confidence-regions" title="Link to this heading">#</a></h2>
<p>The likelihood-ratio test (sometimes called the likelihood-ratio <span class="math notranslate nohighlight">\(\chi^2\)</span> test) is a hypothesis test that helps one choose the “best” model between two models<a class="reference external" href="https://www.statisticshowto.com/likelihood-ratio-tests/">link</a>. Basically, the test compares the fit of two models. The null hypothesis is that the first model is the “best” model; It is rejected when the test statistic is large. In other words, if the null hypothesis is rejected, then the second model is a significant improvement over the first model.</p>
<p>In the last part of this notebook, we use the bootstrap parameter estimates to determine the goodness of fit using the likelihood-ratio <span class="math notranslate nohighlight">\(\chi^2\)</span> test. More information can be found <a class="reference external" href="https://pyomo.readthedocs.io/en/stable/contributed_packages/parmest/api.html#pyomo.contrib.parmest.parmest.Estimator.likelihood_ratio_test">here</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">itertools</span><span class="w"> </span><span class="kn">import</span> <span class="n">product</span>
<span class="c1">### Likelihood ratio test</span>

<span class="c1"># generate arrays of parameter values</span>
<span class="n">A1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">180.0</span><span class="p">,</span> <span class="mf">190.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="n">A2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">395.0</span><span class="p">,</span> <span class="mf">405.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="n">E1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">5.0</span><span class="p">,</span> <span class="mf">15.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="n">E2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

<span class="c1"># format parameter values into a pandas dataframe to be provided as input to calculate</span>
<span class="c1"># corresponding objective function values</span>
<span class="c1"># theta_vals = pd.DataFrame(list(product(A1, A2, E1, E2)), columns=theta_names)</span>
<span class="n">theta_vals</span> <span class="o">=</span> <span class="n">bootstrap_theta</span>
<span class="n">obj_at_theta</span> <span class="o">=</span> <span class="n">pest</span><span class="o">.</span><span class="n">objective_at_theta</span><span class="p">(</span><span class="n">theta_vals</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">obj_at_theta</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>          E2        E1          A2          A1       obj
0  14.728451  9.777382  366.382668  179.167485  0.224777
1  14.008765  9.304571  300.100481  145.197585  0.226707
2  15.477783  9.680324  499.998675  176.293973  0.224614
3  14.647181  9.450998  355.859651  152.982091  0.228158
4  14.948308  9.971654  413.297037  194.342527  0.222223
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">LR</span> <span class="o">=</span> <span class="n">pest</span><span class="o">.</span><span class="n">likelihood_ratio_test</span><span class="p">(</span><span class="n">obj_at_theta</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">LR</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>          E2        E1          A2          A1       obj   0.8  0.85   0.9  \
0  14.728451  9.777382  366.382668  179.167485  0.224777  True  True  True   
1  14.008765  9.304571  300.100481  145.197585  0.226707  True  True  True   
2  15.477783  9.680324  499.998675  176.293973  0.224614  True  True  True   
3  14.647181  9.450998  355.859651  152.982091  0.228158  True  True  True   
4  14.948308  9.971654  413.297037  194.342527  0.222223  True  True  True   

   0.95  
0  True  
1  True  
2  True  
3  True  
4  True  
</pre></div>
</div>
</div>
</div>
<p>The likelihood ratio test results with confidence <span class="math notranslate nohighlight">\(\alpha\)</span> can be visualized as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pyomo</span><span class="o">.</span><span class="n">contrib</span><span class="o">.</span><span class="n">parmest</span><span class="o">.</span><span class="n">graphics</span><span class="o">.</span><span class="n">pairwise_plot</span><span class="p">(</span><span class="n">LR</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span>
                      <span class="n">title</span><span class="o">=</span><span class="s1">&#39;LR results within 80</span><span class="si">% c</span><span class="s1">onfidence region&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Objective contour plot for E2 E1 slice failed
Objective contour plot for E2 A2 slice failed
Objective contour plot for E1 A2 slice failed
Objective contour plot for E2 A1 slice failed
Objective contour plot for E1 A1 slice failed
Objective contour plot for A2 A1 slice failed
Objective contour plot for E1 E2 slice failed
Objective contour plot for A2 E2 slice failed
Objective contour plot for A1 E2 slice failed
Objective contour plot for A2 E1 slice failed
Objective contour plot for A1 E1 slice failed
Objective contour plot for A1 A2 slice failed
</pre></div>
</div>
<img alt="../../_images/ea034384ede8761bbd179706a24ef7a1bbd659638daf96b0e19c0ad295dc9ffc.png" src="../../_images/ea034384ede8761bbd179706a24ef7a1bbd659638daf96b0e19c0ad295dc9ffc.png" />
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./notebooks/5"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="data.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">5. </span>Data Science and Applied Statistics</p>
      </div>
    </a>
    <a class="right-next"
       href="Parmest-generate-data.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">5.2. </span>Supplementary material: data for parmest tutorial</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-is-parameter-estimation">5.1.1. What is parameter estimation?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-is-parmest">5.1.2. What is <code class="docutils literal notranslate"><span class="pre">parmest</span></code>?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-reaction-kinetics">5.1.3. Example: Reaction Kinetics</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#batch-reactor">5.1.3.1. Batch Reactor</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#experimental-data">5.1.3.2. Experimental Data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pyomo-model">5.1.3.3. Pyomo model</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#parameter-estimation-with-a-single-dataset">5.1.4. Parameter estimation with a single dataset</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#parameter-estimation-with-multiple-datasets">5.1.5. Parameter estimation with multiple datasets</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#generate-experiment-list">5.1.5.1. Generate Experiment list</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">5.1.5.2. Parameter estimation with parmest</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plotting-fitted-model-simulation-with-experimental-data">5.1.5.3. Plotting fitted model simulation with ‘experimental’ data</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#using-parmest-with-pyomo-dae">5.1.6. Using <code class="docutils literal notranslate"><span class="pre">parmest</span></code> with <code class="docutils literal notranslate"><span class="pre">pyomo.dae</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">5.1.6.1. Parameter estimation with parmest</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">5.1.6.2. Plotting fitted model simulation with ‘experimental’ data</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#local-uncertainty-analysis">5.1.7. Local uncertainty analysis</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#covariance-matrix">5.1.7.1. Covariance matrix</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#parameter-identifiability">5.1.7.2. Parameter identifiability</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#bootstrap-resampling">5.1.8. Bootstrap resampling</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#nonlinear-confidence-regions">5.1.9. Nonlinear confidence regions</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Alexander Dowling, et al.
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>